
        <!doctype html>
        <html>
        <head>
            <meta charset="utf-8"/>
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
            <title>Why AMP is fast</title>
            <link rel="stylesheet" href="../css/article.css" />;
        </head>
        <body>
            <div class="m-content">
                <h1>Why AMP is fast</h1>
                <div class="section-inner layoutSingleColumn"><h3 name="b535" id="b535" class="graf--h3 graf--first">Why AMP is fast</h3><p name="e66f" id="e66f" class="graf--p graf-after--h3">The <a href="https://www.ampproject.org/" data-href="https://www.ampproject.org/" class="markup--anchor markup--p-anchor" rel="nofollow">AMP Project</a> aims to bring instant rendering to web content. This is an unsorted list of optimizations that apply to all AMP based documents, which in aggregate makes them load fast. Every web page can have these optimizations, but AMP pages <strong class="markup--strong markup--p-strong">cannot not</strong> have them.</p><p name="6eda" id="6eda" class="graf--p graf-after--p">While this article is about optimizations in AMP, it might also be useful as a kind of todo list for optimizing a non-AMP website. If we are missing any optimization that might be benifitial to AMP, please leave a comment or send us a <a href="https://github.com/ampproject/amphtml" data-href="https://github.com/ampproject/amphtml" class="markup--anchor markup--p-anchor" rel="nofollow">pull request</a>.</p><h4 name="d578" id="d578" class="graf--h4 graf-after--p">Lazy loading</h4><p name="3d30" id="3d30" class="graf--p graf-after--h4">Resources are lazy loaded when it becomes likely that they’ll be seen by the user or when the document is otherwise idle.</p><h4 name="dac1" id="dac1" class="graf--h4 graf-after--p">Extensive use of preconnect</h4><p name="95e7" id="95e7" class="graf--p graf-after--h4">The new <a href="http://www.w3.org/TR/resource-hints/#dfn-preconnect" data-href="http://www.w3.org/TR/resource-hints/#dfn-preconnect" class="markup--anchor markup--p-anchor" rel="nofollow">preconnect</a> API is used heavily to ensure HTTP requests are as fast as possible when they are made. This helps makes lazy loaded requests faster when they are eventually made.</p><h4 name="f7c1" id="f7c1" class="graf--h4 graf-after--p">Prefetching of lazy loaded resources</h4><p name="2d54" id="2d54" class="graf--p graf-after--h4">Resources are loaded as late as possible, but prefetched as early as possible. That way things load very fast but CPU is only used when resources are actually shown to users.</p><h4 name="32b2" id="32b2" class="graf--h4 graf-after--p">All async JavaScript</h4><p name="284e" id="284e" class="graf--p graf-after--h4">AMP files are only valid if all JavaScript files are loaded asynchronously.</p><h4 name="2d50" id="2d50" class="graf--h4 graf-after--p">Inline style sheets</h4><p name="94f5" id="94f5" class="graf--p graf-after--h4">Only inline style sheets are allowed in AMP. This removes 1 or often more HTTP requests from the critical rendering path compared to most web pages.</p><h4 name="008f" id="008f" class="graf--h4 graf-after--p">Zero HTTP requests block font downloads.</h4><p name="3601" id="3601" class="graf--p graf-after--h4">Because all JS in AMP has the async attribute and only inline style sheets are allowed, no HTTP requests block the browser from downloading fonts.</p><h4 name="3a1f" id="3a1f" class="graf--h4 graf-after--p">Instant loading through prerendering</h4><p name="0758" id="0758" class="graf--p graf-after--h4">AMP is optimized for making it relatively “cheap” and reliable to prerender a resource. This means that it is rendered before the user explicitly states that they’d like to navigate to a page. With this a page might already be available by the time the user actually selects it, leading to <strong class="markup--strong markup--p-strong">instant loading</strong>.</p><p name="5789" id="5789" class="graf--p graf-after--p">While prerendering can be applied to all web content, that may (and does in practice) use up a lot of bandwidth and CPU. AMP is optimized to reduce both of these factors:</p><h4 name="2921" id="2921" class="graf--h4 graf-after--p">Prerendering only downloads resources above the fold</h4><p name="f8f4" id="f8f4" class="graf--p graf-after--h4">When AMP documents get prerendered for <strong class="markup--strong markup--p-strong">instant </strong>loading, only resources above the fold are actually downloaded. <a href="https://medium.com/@cramforce/why-amp-html-does-not-take-full-advantage-of-the-preload-scanner-7e7f788aa94e" data-href="https://medium.com/@cramforce/why-amp-html-does-not-take-full-advantage-of-the-preload-scanner-7e7f788aa94e" class="markup--anchor markup--p-anchor">Details.</a></p><h4 name="6056" id="6056" class="graf--h4 graf-after--p">Prerendering does not render things that might be expensive in terms of CPU</h4><p name="7c93" id="7c93" class="graf--p graf-after--h4">When AMP documents get prerendered for <strong class="markup--strong markup--p-strong">instant</strong> loading, resources that might use a lot of CPU (like third party iframes) do not get downloaded. <a href="https://medium.com/@cramforce/why-amp-html-does-not-take-full-advantage-of-the-preload-scanner-7e7f788aa94e" data-href="https://medium.com/@cramforce/why-amp-html-does-not-take-full-advantage-of-the-preload-scanner-7e7f788aa94e" class="markup--anchor markup--p-anchor">Details.</a></p><h4 name="5a20" id="5a20" class="graf--h4 graf-after--p">Intelligent resource prioritization</h4><p name="e84a" id="e84a" class="graf--p graf-after--h4">When AMP downloads resources it optimizes downloads so that those resources that are currently most important for the user are downloaded first.</p><h4 name="f51a" id="f51a" class="graf--h4 graf-after--p">Uncoupling of document layout from resource downloads</h4><p name="2eb0" id="2eb0" class="graf--p graf-after--h4">External resources such as images, ads or iframes need to state their size in the HTML. That means they don’t have to be downloaded first to layout the document.</p><h4 name="c9c5" id="c9c5" class="graf--h4 graf-after--p">Maximum size for style sheet</h4><p name="343b" id="343b" class="graf--p graf-after--h4">The inline style sheet has a maximum size. While this size is big enough for very sophisticated pages, it still requires the page author to practice good CSS hygiene.</p><h4 name="2442" id="2442" class="graf--h4 graf-after--p"><a href="https://github.com/wilsonpage/fastdom" data-href="https://github.com/wilsonpage/fastdom" class="markup--anchor markup--h4-anchor" rel="nofollow">FastDOM</a>-style DOM change batching</h4><p name="2e16" id="2e16" class="graf--p graf-after--h4">We batch all DOM measure and mutate operations to minimize style recalculations in the browsers.</p><p name="d5d8" id="d5d8" class="graf--p graf-after--p">In practice this means that in each <a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" data-href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" class="markup--anchor markup--p-anchor" rel="nofollow">“animation frame”</a> we first do all the DOM read operations, and then when those are done, do all the write operations. The result is a reduction to 1 style recalculation per frame.</p><h4 name="150a" id="150a" class="graf--h4 graf-after--p">Optimized for low count of style recalculations and layout</h4><p name="e0de" id="e0de" class="graf--p graf-after--h4">Independent of the above, AMP is optimized to avoid expensive style recalculations and layouts in the browser.</p><h4 name="c482" id="c482" class="graf--h4 graf-after--p">Mitigations for third party JS worst-practices such as document.write</h4><p name="62e9" id="62e9" class="graf--p graf-after--h4">In particular if third party JS uses the super-bad-for-performance “document.write” API, it does not block rendering the main page.</p><h4 name="e666" id="e666" class="graf--h4 graf-after--p">Runtime cost of analytics instrumentation is independent of number of used analytics providers</h4><p name="99c5" id="99c5" class="graf--p graf-after--h4">The way analytics are being implemented in AMP, pages that have more than one analytics provider do not get bloated with additional JavaScript and do not use significant extra CPU.</p><h4 name="5d50" id="5d50" class="graf--h4 graf-after--p">Extensions don’t block page layout</h4><p name="1fa3" id="1fa3" class="graf--p graf-after--h4">AMP supports extensions for things like lightboxes, instagram embeds, tweets, etc. While these require additional HTTP requests, those requests do not block page layout and rendering.</p><h4 name="c3cb" id="c3cb" class="graf--h4 graf-after--p">CDN delivery available to all AMP documents</h4><p name="164c" id="164c" class="graf--p graf-after--h4">AMP offers a proxy-based CDN for delivering all valid AMP documents, offering fast and reliable performance across all AMP content.</p><h4 name="a23c" id="a23c" class="graf--h4 graf-after--p">All resources and the document are loaded from the same origin through the same HTTP 2.0 tunnel</h4><p name="b9a0" id="b9a0" class="graf--p graf-after--h4">When using the proxy-based AMP CDN, the document, all JS files and all images are loaded from the same origin that is using <a href="https://http2.github.io/" data-href="https://http2.github.io/" class="markup--anchor markup--p-anchor" rel="nofollow">HTTP 2.0</a> for maximum efficiency.</p><h4 name="8d36" id="8d36" class="graf--h4 graf-after--p">Animations can be GPU accelerated</h4><p name="694c" id="694c" class="graf--p graf-after--h4 graf--last">The rules for animation related CSS in AMP ensure that animations can be GPU accelerated on modern devices, so they are smooth and buttery.</p></div>
            </div>
            <script>var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-34802167-1']); _gaq.push(['_setDomainName', 'liuzhe.co']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();</script>
        </body>
        </html>