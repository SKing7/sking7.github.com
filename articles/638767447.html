<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>PHP vs node.js: The REAL statistics</title>
<link rel="stylesheet" href="../css/article.css" />
</head>
<body>
<div class="m-content">
<h1>PHP vs node.js: The REAL statistics</h1>
<div><p>When it comes to web programming, I’ve always coded in ASP.NET or the LAMP technologies for most part of my life. Now, the new buzz in the city is <a href="https://en.wikipedia.org/wiki/Node.js" target="_blank">node.js</a>. It is a light-weight platform that runs javascript code on server-side and is said to improvise performance by using async I/O.</p><p>The <a href="http://notes.ericjiang.com/posts/751" target="_blank">theory</a> suggests that synchronous or blocking model of I/O works something like this:</p><p><a href="http://www.prahladyeri.com/wp-content/uploads/2014/06/nodejs.png"><img src="http://www.prahladyeri.com/wp-content/uploads/2014/06/nodejs.png" alt="Blocking I/O" width="504" height="352" /></a></p><p>I/O is typically the costliest part of a web transaction. When a request arrives to the apache web server, it passes it to PHP interpreter for scripting any dynamic contents. Now comes the tricky part – If the PHP script wants to read something from the disk/database or write to it, that is the slowest link in the chain. When you call PHP function file_get_contents(), the entire thread is blocked until the contents are retrieved! The server can’t do anything until your script gets the file contents. Consider what happens when multiples of simultaneous requests are issued by different users to your server? They get queued, because no thread is available to do the job since they are all blocked in I/O!</p><p>Here comes the unique selling-point of node.js. Since node.js implements async I/O in almost all its functions, the server thread in the above scenario is freed as soon as the file retrieval function (fs.readFile) is called. Then, once the I/O completes, node calls a function (passed earlier by fs.readFile) along with the data parameters. In the meantime, that valuable thread can be used for serving some other request.</p><p>So thats the theory about it anyway. But I’m not someone who just accepts any new fad in the town just because it is hype and everyone uses it. Nope, I want to get under the covers and verify it for myself. I wanted to see whether this theory holds in actual practice or not.</p><p>So I brought upon myself the job of writing two simple scripts for benchmarking this – one in PHP (hosted on apache2) and other in javascript (hosted on node.js). The test itself was very simple. The script would:</p><p>1. Accept the request.<br />2. Generate a random string of 108 kilobytes.<br />3. Write the string to a file on the disk.<br />4. Read the contents back from disk.<br />5. Return the string back on the response stream.</p><p>This is the first script, index.php:</p><div><table><tr><td><pre><span>&lt;?php</span>
<span>//index.php</span>
<span>$s</span><span>=</span><span>""</span><span>;</span> <span>//generate a random string of 108KB and a random filename</span>
<span>$fname</span> <span>=</span> <span>chr</span><span>(</span><span>rand</span><span>(</span><span>0</span><span>,</span><span>57</span><span>)</span><span>+</span><span>65</span><span>)</span><span>.</span><span>chr</span><span>(</span><span>rand</span><span>(</span><span>0</span><span>,</span><span>57</span><span>)</span><span>+</span><span>65</span><span>)</span><span>.</span><span>chr</span><span>(</span><span>rand</span><span>(</span><span>0</span><span>,</span><span>57</span><span>)</span><span>+</span><span>65</span><span>)</span><span>.</span><span>chr</span><span>(</span><span>rand</span><span>(</span><span>0</span><span>,</span><span>57</span><span>)</span><span>+</span><span>65</span><span>)</span><span>.</span><span>'.txt'</span><span>;</span>
<span>for</span><span>(</span><span>$i</span><span>=</span><span>0</span><span>;</span><span>$i</span><span>&lt;</span><span>108000</span><span>;</span><span>$i</span><span>++</span><span>)</span>
<span>{</span>
	<span>$n</span><span>=</span><span>rand</span><span>(</span><span>0</span><span>,</span><span>57</span><span>)</span><span>+</span><span>65</span><span>;</span>
	<span>$s</span> <span>=</span> <span>$s</span><span>.</span><span>chr</span><span>(</span><span>$n</span><span>)</span><span>;</span>
<span>}</span>
&nbsp;
<span>//write s to a file</span>
<span>file_put_contents</span><span>(</span><span>$fname</span><span>,</span><span>$s</span><span>)</span><span>;</span>
<span>$result</span> <span>=</span> <span>file_get_contents</span><span>(</span><span>$fname</span><span>)</span><span>;</span>
<span>echo</span> <span>$result</span><span>;</span></pre></td></tr></table></div><p>And here is the second script, server.js:</p><div><table><tr><td><pre><span>//server.js</span>
<span>var</span> http <span>=</span> require<span>(</span><span>'http'</span><span>)</span><span>;</span>	
<span>var</span> server <span>=</span> http.<span>createServer</span><span>(</span>handler<span>)</span><span>;</span>
&nbsp;
<span>function</span> handler<span>(</span>request<span>,</span> response<span>)</span> <span>{</span>
	<span>//console.log('request received!');</span>
	response.<span>writeHead</span><span>(</span><span>200</span><span>,</span> <span>{</span><span>'Content-Type'</span><span>:</span> <span>'text/plain'</span><span>}</span><span>)</span><span>;</span>
&nbsp;
	s<span>=</span><span>""</span><span>;</span> <span>//generate a random string of 108KB and a random filename</span>
	fname <span>=</span> <span>String</span>.<span>fromCharCode</span><span>(</span><span>Math</span>.<span>floor</span><span>(</span><span>65</span> <span>+</span> <span>(</span><span>Math</span>.<span>random</span><span>(</span><span>)</span><span>*</span><span>(</span><span>122</span><span>-</span><span>65</span><span>)</span><span>)</span> <span>)</span><span>)</span> <span>+</span>
		<span>String</span>.<span>fromCharCode</span><span>(</span><span>Math</span>.<span>floor</span><span>(</span><span>65</span> <span>+</span> <span>(</span><span>Math</span>.<span>random</span><span>(</span><span>)</span><span>*</span><span>(</span><span>122</span><span>-</span><span>65</span><span>)</span><span>)</span> <span>)</span><span>)</span> <span>+</span>
		<span>String</span>.<span>fromCharCode</span><span>(</span><span>Math</span>.<span>floor</span><span>(</span><span>65</span> <span>+</span> <span>(</span><span>Math</span>.<span>random</span><span>(</span><span>)</span><span>*</span><span>(</span><span>122</span><span>-</span><span>65</span><span>)</span><span>)</span> <span>)</span><span>)</span> <span>+</span> 
		<span>String</span>.<span>fromCharCode</span><span>(</span><span>Math</span>.<span>floor</span><span>(</span><span>65</span> <span>+</span> <span>(</span><span>Math</span>.<span>random</span><span>(</span><span>)</span><span>*</span><span>(</span><span>122</span><span>-</span><span>65</span><span>)</span><span>)</span> <span>)</span><span>)</span> <span>+</span> <span>".txt"</span><span>;</span>
&nbsp;
	<span>for</span><span>(</span>i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span><span>108000</span><span>;</span>i<span>++</span><span>)</span>
	<span>{</span>
		n<span>=</span><span>Math</span>.<span>floor</span><span>(</span><span>65</span> <span>+</span> <span>(</span><span>Math</span>.<span>random</span><span>(</span><span>)</span><span>*</span><span>(</span><span>122</span><span>-</span><span>65</span><span>)</span><span>)</span> <span>)</span><span>;</span>
		s<span>+=</span><span>String</span>.<span>fromCharCode</span><span>(</span>n<span>)</span><span>;</span>
	<span>}</span>
&nbsp;
	<span>//write s to a file</span>
	<span>var</span> fs <span>=</span> require<span>(</span><span>'fs'</span><span>)</span><span>;</span>
	fs.<span>writeFile</span><span>(</span>fname<span>,</span> s<span>,</span> <span>function</span><span>(</span>err<span>,</span> fd<span>)</span> <span>{</span>
			<span>if</span> <span>(</span>err<span>)</span> <span>throw</span> err<span>;</span>
			<span>//console.log("The file was saved!");</span>
			<span>//read back from the file</span>
			fs.<span>readFile</span><span>(</span>fname<span>,</span> <span>function</span> <span>(</span>err<span>,</span> data<span>)</span> <span>{</span>
				<span>if</span> <span>(</span>err<span>)</span> <span>throw</span> err<span>;</span>
				result <span>=</span> data<span>;</span>
				response.<span>end</span><span>(</span>result<span>)</span><span>;</span>
			<span>}</span><span>)</span><span>;</span>	
		<span>}</span>
	<span>)</span><span>;</span>
<span>}</span>
&nbsp;
server.<span>listen</span><span>(</span><span>8124</span><span>)</span><span>;</span>
console.<span>log</span><span>(</span><span>'Server running at http://127.0.0.1:8124/'</span><span>)</span><span>;</span></pre></td></tr></table></div><p>And then, I ran the apache benchmarking tool on both of them with 2000 requests (200 concurrent). When I saw the time stats of the result, I was astounded:</p><div><table><tr><td><pre>#PHP:
Concurrency Level:      200
Time taken for tests:   574.796 seconds
Complete requests:      2000
&nbsp;
#node.js:
Concurrency Level:      200
Time taken for tests:   41.887 seconds
Complete requests:      2000</pre></td></tr></table></div><p>The truth is out. node.js was faster than PHP by more 14 times! These results are astonishing. It simply means that node.js IS going to be THE de-facto standard for writing performance driven apps in the upcoming future, there is no doubt about it!</p><p>Agreed that the <a href="http://nodejs.org" target="_blank">nodejs</a> ecosystem isn’t that widely developed yet, and most node modules for things like db connectivity, network access, utilities, etc. are actively being developed. But still, after seeing these results, its a no-brainer. Any extra effort spent in developing node.js apps is more than worth it. PHP might be still having the “king of web” status, but with node.js in the town, I don’t see that status staying for very long!</p><p>References</p><ol>
<li><a href="https://en.wikipedia.org/wiki/Node.js" target="_blank">https://en.wikipedia.org/wiki/Node.js</a></li>
<li><a href="http://notes.ericjiang.com/posts/751" target="_blank">http://notes.ericjiang.com/posts/751</a></li>
<li><a href="http://nodejs.org" target="_blank">http://nodejs.org</a></li>
<li><a href="https://code.google.com/p/node-js-vs-apache-php-benchmark/wiki/Tests">https://code.google.com/p/node-js-vs-apache-php-benchmark/wiki/Tests</a></li>
</ol></div></div>
<script>var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-34802167-1']); _gaq.push(['_setDomainName', 'liuzhe.co']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();</script></body>
</html>