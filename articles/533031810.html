<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>What’s with putting the CSS in the head? — Coding &amp; Design — Medium</title>
<link rel="stylesheet" href="../css/article.css" />
</head>
<body>
<div class="m-content">
<h1>What’s with putting the CSS in the head? — Coding &amp; Design — Medium</h1>
<div><p name="283a">Throughout my development years, the default practice has been to place all CSS in an external minified CSS. Then place this CSS file on a CDN, which would help improve loading time by hosting this file on multiple servers, one of which maybe geographically closer to the user and thus load quicker (reducing latency).</p><p name="6622">That said, there’s a growing discussion and practice around placing the CSS within the head of an HTML page. You are probably thinking, what? To understand the logic behind this we need to understand how a browser works. Although there are differences from browser to browser, the fundamentals are the same.</p><figure name="26ff"><img data-width="1840" data-height="814" width="700" height="310" data-action="zoom" data-action-value="1*3gtIv6vx3jUCbzdzN32zuA.png" src="https://d262ilb51hltx0.cloudfront.net/max/800/1*3gtIv6vx3jUCbzdzN32zuA.png" /><figcaption>The Rendering Engine of a Browser<br />credit: <a target="_blank" href="https://speakerdeck.com/patrickhamann/css-and-the-critical-path" rel="nofollow">https://speakerdeck.com/patrickhamann/css-and-the-critical-path</a></figcaption></figure><p name="78de">When a HTML page is loaded on a browser — the browser makes the network call which then returns a response. This response is known as the critical path. Stoyan Stefanov in 2012, describes the critical path as follows:</p><p name="68e3">“Critical is the path from the user following a link to the first impression and then the working experience .</p><p name="7b78">So the critical path essentially relies on three factors: The HTML, CSS and the Javascript.</p><p name="f3e4">The path is initially split into two main paths, the HTML and CSS path. The HTML is read by HTML parsers and builds DOM and this then becomes part of the render tree. The CSS path: The CSS is read by conventional parsers, which create the CSSOM and then becomes part of the render tree.</p><p name="6738">When a javascript tag is read — the browser can behave in a number of ways. If it’s an external file — it will stop everything and download the file and then continue with the building of the DOM. It will never run the javascript because if the javascript references the CSS, which hasn’t been downloaded — it will fail. Some browsers like Mozilla tend to block all javascript activity until the CSS has been downloaded and the CSSOM have been created. Webkit — behaves slightly differently by “pre-reading”, and then holding the javascript whenever it makes a reference to the CSSOM. There are techniques such as adding <strong>defer </strong>into the script tag for HTML4 browsers or <strong>async </strong>for HTML5 browsers that prevent the javascript from appearing in the critical path. Thus reducing the dependencies in the critical path to two: the HTML and CSS.</p><p name="d216">The purpose of putting the CSS in the head is to reduce or rather try and keep much of the CSS as possible off the critical path by downloading it as quick as possible. To understand this, we need to look at the anatomy of a network request. See below:</p><figure name="2c3a"><img data-width="1876" data-height="670" width="700" height="250" data-action="zoom" data-action-value="1*6d8p_0_9RC3Fj6ObMI_4ng.png" src="https://d262ilb51hltx0.cloudfront.net/max/800/1*6d8p_0_9RC3Fj6ObMI_4ng.png" /><figcaption>credit: <a target="_blank" href="https://speakerdeck.com/patrickhamann/css-and-the-critical-path" rel="nofollow">https://speakerdeck.com/patrickhamann/css-and-the-critical-path</a></figcaption></figure><p name="5c98">When a network request is made, there is latency involved (the dark green, orange and light green blocks). This is something we cannot really eliminate unless the technology for transferring information makes a significant leap. So the point of putting the CSS in the head is to eliminate the latency in the network request, ie there is no network request for the CSS — so it the CSSOM building starts immediately. By doing this, the point in which the render tree is created happens sooner rather than later in the process. Thus the page performance greatly improves.</p><p name="9046">Below is the current the network diagram of the login page for for a web app.</p><figure name="bbb5"><img data-width="1193" data-height="301" width="700" height="177" data-action="zoom" data-action-value="1*UAoXEHLJDXC_jMHA8uunqA.png" src="https://d262ilb51hltx0.cloudfront.net/max/800/1*UAoXEHLJDXC_jMHA8uunqA.png" /><figcaption>(caveat: I’ve literally copied the CSS, which was unminified, the html tags and scripts that it uses and placed them on a different server)</figcaption></figure><p name="7bd6">As you can see it takes 378ms to load. In comparison, the next diagram below, I’ve minified the CSS and placed it into the head of the html page.</p><figure name="5da3"><img data-width="1195" data-height="300" width="700" height="176" data-action="zoom" data-action-value="1*JCAIS8NyTpTOIwFOXm7skQ.png" src="https://d262ilb51hltx0.cloudfront.net/max/800/1*JCAIS8NyTpTOIwFOXm7skQ.png" /><figcaption>CSS is placed within head of the HTML Page</figcaption></figure><p name="5936">In this case the page loads in 225ms. That’s near 150ms faster than the unmodified version. One might argue that the significance of 150ms is irrelevant, but before you do, read this <a target="_blank" href="http://www.webperformancetoday.com/2012/03/21/neuroscience-page-speed-web-performance/" rel="nofollow">article</a>.</p><p name="9b8f">I’ve had a look at <a target="_blank" href="http://www.google.com/" rel="nofollow">Google</a> and below are the findings of their current site.</p><figure name="3819"><img data-width="2594" data-height="654" width="700" height="176" data-action="zoom" data-action-value="1*NJQtRHaldhQcyqfb0m-eVg.png" src="https://d262ilb51hltx0.cloudfront.net/max/800/1*NJQtRHaldhQcyqfb0m-eVg.png" /></figure><p name="ceb5">As you can see, putting the CSS in the head means it isn’t part of the network request — in otherwords it’s been removed from the <strong>critical path. </strong>For Google to load 182ms to load and then the DOM content loaded is also 182ms. Effectively, it’s instantaneous.</p><p name="699d">Google (as demonstrated above), Bing and the Guardian are just some of the companies that are doing this now. Some are even differentiating their CSS into two parts, a core CSS (placing this within the head) and a non core CSS, having this as an external CSS. There are some ramifications for doing adopting this approach — I shall discuss this in another post.</p><p name="1e10">Placing your CSS within the head of your HTML page does <strong>increase </strong>the performance of your web page. I feel it is only a matter of time before this approach becomes the default practice.</p><p name="1b2e">Thanks to <a target="_blank" href="https://twitter.com/patrickhamann" rel="nofollow">Patrick Hamann</a> for his inspiring talks he did on web page peformance last year, which I owe a lot of this post to. Also to <a target="_blank" href="http://www.html5rocks.com/profiles/#paulirish" rel="nofollow">Paul Irish</a> and <a target="_blank" href="http://www.html5rocks.com/profiles/#taligarsiel" rel="nofollow">Tali Garsiel</a> for their incredibly informative article: <a target="_blank" href="http://www.html5rocks.com/en/tutorials/internals/howbrowserswork/" rel="nofollow">How Browsers Work: Behind the scenes of modern web browsers</a>.</p></div></div>
<script>var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-34802167-1']); _gaq.push(['_setDomainName', 'liuzhe.co']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();</script></body>
</html>