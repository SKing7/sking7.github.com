<!DOCTYPE html>
<html dir="ltr" lang="zh-CN" xmlns:wb="http://open.weibo.com/wb">
<head>
<meta charset="UTF-8" />
<meta property="qc:admins" content="147062105661447145156375" />
<title>【译】编写高性能JavaScript | Tencent AlloyTeam</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="http://www.alloyteam.com/wp-content/themes/alloyteam/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="http://www.alloyteam.com/wp-includes/syntaxhighlighter/styles/shCoreDefault.css" />
<link rel="pingback" href="http://www.alloyteam.com/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="Tencent AlloyTeam &raquo; 【译】编写高性能JavaScript 评论 Feed" href="http://www.alloyteam.com/2012/11/performance-writing-efficient-javascript/feed/" />
<link rel='stylesheet' id='author-avatars-shortcode-css'  href='http://www.alloyteam.com/wp-content/plugins/author-avatars/css/shortcode.css?ver=1.6.2' type='text/css' media='all' />
<link rel='stylesheet' id='author-avatars-widget-css'  href='http://www.alloyteam.com/wp-content/plugins/author-avatars/css/widget.css?ver=1.6.2' type='text/css' media='all' />
<script type='text/javascript' src='http://www.alloyteam.com/wp-includes/js/jquery/jquery.js?ver=1.7.2'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.alloyteam.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.alloyteam.com/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='【公益支教行】一位米粉阿姨勤劳致富的故事' href='http://www.alloyteam.com/2012/11/charity-to-support-education-line-a-rice-aunt-wealth-through-hard-story-2/' />
<link rel='next' title='“筑梦学堂，一起去支教”拥抱自然，回归田园' href='http://www.alloyteam.com/2012/11/4152/' />
<meta name="generator" content="WordPress 3.4.2, fitted with the WordPress Mobile Pack 1.2.5" />
<link rel='shortlink' href='http://www.alloyteam.com/?p=4120' />

<!-- All in One SEO Pack 1.6.15.2 by Michael Torbert of Semper Fi Web Designob_start_detected [-1,-1] -->
<meta name="keywords" content="javascript,web前端,性能优化" />
<link rel="canonical" href="http://www.alloyteam.com/2012/11/performance-writing-efficient-javascript/" />
<!-- /all in one seo pack -->

<!-- lazyload images -->
<style type="text/css">
.lh_lazyimg{
opacity:0.2;filter:alpha(opacity=20);
background:url(http://www.alloyteam.com/wp-content/plugins/images-lazyload-and-slideshow/loading.gif) no-repeat center center;
}
</style>
<!-- lazyload images end -->

<!-- case nojs, hidden lazyload images -->
<noscript>
<style type="text/css">
.lh_lazyimg{display:none;}
</style>
</noscript>
<!-- case nojs, hidden lazyload images end -->

<!-- lazyload -->
<script type="text/javascript">
jQuery(document).ready(function($) {
	function lazyload(){
		$("img.lh_lazyimg").each(function(){
			_self = $(this);
			if (_self.attr("lazyloadpass")===undefined
					&& _self.attr("file")
					&& (!_self.attr("src")
							|| (_self.attr("src") && _self.attr("file")!=_self.attr("src"))
						)
				) {
				if((_self.offset().top) < ($(window).height()+$(document).scrollTop()+200)
						&& (_self.offset().left) < ($(window).width()+$(document).scrollLeft()+200)
					) {
					_self.attr("src",_self.attr("file"));
					_self.attr("lazyloadpass", "1");
					_self.animate({opacity:"1"}, 400);
				}
			}
		});
	}
	lazyload();

	var itv;
	$(window).scroll(function(){clearTimeout(itv);itv=setTimeout(lazyload,400);});
	$(window).resize(function(){clearTimeout(itv);itv=setTimeout(lazyload,400);});
});
</script>
<!-- lazyload end -->

<!-- prettyPhoto -->
<link rel="stylesheet" href="http://www.alloyteam.com/wp-content/plugins/images-lazyload-and-slideshow/prettyPhoto/css/prettyPhoto.css" type="text/css" media="screen" charset="utf-8"/>
<script type="text/javascript" src="http://www.alloyteam.com/wp-content/plugins/images-lazyload-and-slideshow/prettyPhoto/js/jquery.prettyPhoto.js" charset="utf-8"></script>
<script type="text/javascript">
jQuery(function($){
	$(".content_banner img").each(function(i){
		_self = $(this);

		selfWidth = _self.attr("width")?_self.attr("width"):_self.width();
		selfHeight = _self.attr("height")?_self.attr("height"):_self.height();
		if ((selfWidth && selfWidth<50)
				|| (selfHeight && selfHeight<50)) {
			return;
		}

		if (! this.parentNode.href) {
			imgsrc = "";

			if (_self.attr("src")) {
				imgsrc = _self.attr("src");
			}
			if (_self.attr("file")) {
				imgsrc = _self.attr("file");
			} else if (_self.attr("original")) {
				imgsrc = _self.attr("original");
			}

			if (imgsrc) {
				_self.addClass("slideshow_imgs");
				_self.wrap("<a href='"+imgsrc+"' rel='prettyPhoto[1]'></a>");
			}
		} else {
			aHref = this.parentNode.href;
			var b=/.+(\.jpg)|(\.jpeg)|(\.png)|(\.gif)|(\.bmp)/i;
			if (! b.test(aHref)) {
				return;
			}

			_self.addClass("slideshow_imgs");

			_parentA = $(this.parentNode);
			rel = _parentA.attr("rel");
			if (! rel) {
				rel = "";
			}
			if (rel.indexOf("prettyPhoto") != 0) {
				_parentA.attr("rel","prettyPhoto[1]");
			}
		}
	});

	$("a[rel^='prettyPhoto']").prettyPhoto({social_tools:""});
});
</script>
<!-- prettyPhoto end -->
<style type="text/css" media="screen">body{position:relative}#dynamic-to-top{display:none;overflow:hidden;width:auto;z-index:90;position:fixed;bottom:20px;right:20px;top:auto;left:auto;font-family:sans-serif;font-size:1em;color:#fff;text-decoration:none;text-shadow:0 1px 0 #333;font-weight:bold;padding:20px 23px;border:1px solid #aba6a6;background:#3C454F;-webkit-background-origin:border;-moz-background-origin:border;-icab-background-origin:border;-khtml-background-origin:border;-o-background-origin:border;background-origin:border;-webkit-background-clip:padding-box;-moz-background-clip:padding-box;-icab-background-clip:padding-box;-khtml-background-clip:padding-box;-o-background-clip:padding-box;background-clip:padding-box;-webkit-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );-ms-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );-moz-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );-o-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );-khtml-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );-icab-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 ), inset 0 0 0 1px rgba( 0, 0, 0, 0.2 ), inset 0 1px 0 rgba( 255, 255, 255, .4 ), inset 0 10px 10px rgba( 255, 255, 255, .1 );-webkit-border-radius:2px;-moz-border-radius:2px;-icab-border-radius:2px;-khtml-border-radius:2px;border-radius:2px}#dynamic-to-top:hover{background:#4fd687;background:#3C454F -webkit-gradient( linear, 0% 0%, 0% 100%, from( rgba( 255, 255, 255, .2 ) ), to( rgba( 0, 0, 0, 0 ) ) );background:#3C454F -webkit-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );background:#3C454F -khtml-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );background:#3C454F -moz-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );background:#3C454F -o-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );background:#3C454F -ms-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );background:#3C454F -icab-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );background:#3C454F linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );cursor:pointer}#dynamic-to-top:active{background:#3C454F;background:#3C454F -webkit-gradient( linear, 0% 0%, 0% 100%, from( rgba( 0, 0, 0, .3 ) ), to( rgba( 0, 0, 0, 0 ) ) );background:#3C454F -webkit-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );background:#3C454F -moz-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );background:#3C454F -khtml-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );background:#3C454F -o-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );background:#3C454F -ms-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );background:#3C454F -icab-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );background:#3C454F linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) )}#dynamic-to-top,#dynamic-to-top:active,#dynamic-to-top:focus,#dynamic-to-top:hover{outline:none}#dynamic-to-top span{display:block;overflow:hidden;width:14px;height:12px;background:url( http://www.alloyteam.com/wp-content/plugins/dynamic-to-top/css/images/up.png )no-repeat center center}</style>

<script type="text/JavaScript">
function addCookie(){　 // 加入收藏夹
	if (document.all){
		window.external.addFavorite('http://www.alloyteam.com', 'Tencent AlloyTeam - 腾讯Web前端 Alloy 团队 Blog');
	}else if (window.sidebar){
		window.sidebar.addPanel('Tencent AlloyTeam - 腾讯Web前端 Alloy 团队 Blog', 'http://www.alloyteam.com', "");
	}
}
</script>
<script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
</head>

<body class="home blog" style="display:none;">
<!--[if IE]> 
<script>document.body.style.display = "block";</script>
<![endif]-->  
<!-- 注释 -->
<div id="alloy">
	<h1 id ="alloyteam" class="alloyteam1">AlloyTeam</h1>
	<h1 id ="alloyteam2" class="alloyteam2"><a href="/">AlloyTeam</a></h1>
	<div id ="tencentInfo">Copyright &copy; <script>document.write(new Date().getFullYear());</script> Tencent AlloyTeam. All Rights Reserved.</div>

</div>

<!--Header-->
<div id="header">
	<div id="top">
		<div id="nav">
			<a onfocus="this.blur()" href="http://www.alloyteam.com" id="logo" title="腾讯Web前端 Alloy 团队 Blog"><cite>Tencent AlloyTeam</cite></a>
			<span class="subtitle">腾讯Web前端 Alloy 团队 Blog</span>
			<div id="menu">
				<div class="widget_search">
					<form method="get" id="searchform" action="http://www.alloyteam.com" target="_blank">
						<input name="s" type="text" value="Search" onfocus="this.value='';" onblur="if(this.value==''){this.value='Search';}">
						<input name="" type="submit" value="" class="so" onmouseout="this.className='so'" onmouseover="this.className='soHover'">
					</form>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="clearfix"></div>	
<div id="main">
	<div id="access">
	<div class="menu-navmenu-container"><ul id="menu-navmenu" class="menu"><li id="menu-item-29" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-29"><a title="腾讯Web前端团队博客 AlloyTeam 首页" href="http://www.alloyteam.com/">首页</a></li>
<li id="menu-item-745" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-745"><a href="http://www.alloyteam.com/category/%e5%89%8d%e7%ab%af%e8%b5%84%e8%ae%af/">前端资讯</a></li>
<li id="menu-item-740" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-740"><a href="http://www.alloyteam.com/category/webfrontend/">Web前端</a>
<ul class="sub-menu">
	<li id="menu-item-855" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-855"><a href="http://www.alloyteam.com/category/webfrontend/html5/">HTML5</a></li>
	<li id="menu-item-856" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-856"><a href="http://www.alloyteam.com/category/webfrontend/css3/">CSS3</a></li>
	<li id="menu-item-854" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-854"><a href="http://www.alloyteam.com/category/webfrontend/javascript/">JavaScript</a></li>
	<li id="menu-item-747" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-747"><a href="http://www.alloyteam.com/category/webfrontend/ued/">用户体验设计</a></li>
	<li id="menu-item-857" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-857"><a href="http://www.alloyteam.com/category/webfrontend/%e5%89%8d%e7%ab%af%e4%bc%98%e5%8c%96/">前端优化</a></li>
</ul>
</li>
<li id="menu-item-748" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-748"><a href="http://www.alloyteam.com/category/%e8%b5%84%e6%ba%90%e5%b7%a5%e5%85%b7/">资源工具</a></li>
<li id="menu-item-1371" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1371"><a href="http://www.alloyteam.com/category/alloylabs/">Alloy实验室</a>
<ul class="sub-menu">
	<li id="menu-item-744" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-744"><a href="http://www.alloyteam.com/category/alloylabs/showcase/">作品</a></li>
	<li id="menu-item-961" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-961"><a href="http://www.alloyteam.com/category/alloylabs/html5game/">HTML5游戏</a></li>
</ul>
</li>
<li id="menu-item-853" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-853"><a title="我们在 Github.com 上的 Web 开源项目" href="http://AlloyTeam.github.com">Github开源</a></li>
<li id="menu-item-746" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-746"><a href="http://www.alloyteam.com/category/team/">团队</a></li>
<li id="menu-item-1327" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1327"><a href="http://www.alloyteam.com/message-board/">留言板</a>
<ul class="sub-menu">
	<li id="menu-item-1335" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1335"><a href="http://www.alloyteam.com/links/">友情链接</a></li>
</ul>
</li>
<li id="menu-item-27" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a title="腾讯AlloyTeam" href="http://www.alloyteam.com/about/">关于</a></li>
</ul></div>	</div>

<!--Header End-->
		<div id="content" role="main">	
<div id="postlist">
	    <div class="content_text"> 

    <div class="title1"> 
    <a href="" class="animated tada singleauthor" target="_blank"><img alt='TAT.Johnny' src="http://www.alloyteam.com/wp-content/plugins/images-lazyload-and-slideshow/blank_1x1.gif" file="http://www.alloyteam.com/wp-content/uploads/2012/06/johnny_avatar-43x43.png" class="avatar avatar-43 photo lh_lazyimg" height='43' width='43' /><noscript><img alt='TAT.Johnny' src='http://www.alloyteam.com/wp-content/uploads/2012/06/johnny_avatar-43x43.png' class='avatar avatar-43 photo' height='43' width='43' /></noscript></a> 
   
    <a href="http://www.alloyteam.com/2012/11/performance-writing-efficient-javascript/" class="blogTitle btitle" rel="bookmark" title="【译】编写高性能JavaScript">【译】编写高性能JavaScript</a> 
    <div class="blogPs"> In <a href="http://www.alloyteam.com/category/webfrontend/javascript/" title="查看 JavaScript 中的全部文章" rel="category tag">JavaScript</a>,<a href="http://www.alloyteam.com/category/webfrontend/" title="查看 Web前端 中的全部文章" rel="category tag">Web前端</a>,<a href="http://www.alloyteam.com/category/webfrontend/%e5%89%8d%e7%ab%af%e4%bc%98%e5%8c%96/" title="查看 前端优化 中的全部文章" rel="category tag">前端优化</a> on 2012年11月20日 by <a href="http://www.alloyteam.com/author/johnny/" title="由 TAT.Johnny 发布" rel="author">TAT.Johnny</a>  view: 10,435 </div> 
    <span class="comments"><a href="http://www.alloyteam.com/2012/11/performance-writing-efficient-javascript/#comments" class="up"  title="《【译】编写高性能JavaScript》上的评论">12</a></span>
    </div> 
    <!--content_banner_single--> 
    <div class="content_banner"> 
    

	
    <div class="text">
    <p>原文：<a onclick="javascript:pageTracker._trackPageview('/outgoing/coding.smashingmagazine.com/2012/11/05/writing-fast-memory-efficient-javascript/');"  href="http://coding.smashingmagazine.com/2012/11/05/writing-fast-memory-efficient-javascript/" target="_blank">http://coding.smashingmagazine.com/2012/11/05/writing-fast-memory-efficient-javascript/</a></p>
<p>作者：<a onclick="javascript:pageTracker._trackPageview('/outgoing/coding.smashingmagazine.com/author/addy-osmani/?rel=author');" title="Posts by Addy Osmani"  href="http://coding.smashingmagazine.com/author/addy-osmani/?rel=author" rel="author">Addy Osmani</a></p>
<p>译者按：本人第一次翻译外文，言语难免有些晦涩，但尽量表达了作者的原意，未经过多的润色，欢迎批评指正。另本文篇幅较长、信息量大，可能难以消化，欢迎留言探讨细节问题。本文主要关注V8的性能优化，部分内容并不适用于所有JS引擎。最后，转载请注明出处: )<span id="more-4120"></span></p>
<p>========================译文分割线===========================</p>
<p>很多JavaScript引擎，如Google的<a onclick="javascript:pageTracker._trackPageview('/outgoing/code.google.com/p/v8/');"  href="http://code.google.com/p/v8/" target="_blank">V8</a>引擎（被Chrome和Node所用），是专门为需要<a onclick="javascript:pageTracker._trackPageview('/outgoing/www.html5rocks.com/en/tutorials/speed/v8/');"  href="http://www.html5rocks.com/en/tutorials/speed/v8/" target="_blank">快速执行</a>的大型JavaScript应用所设计的。如果你是一个开发者，并且关心内存使用情况与页面性能，你应该了解用户浏览器中的JavaScript引擎是如何运作的。无论是V8，<a onclick="javascript:pageTracker._trackPageview('/outgoing/developer.mozilla.org/en-US/docs/SpiderMonkey');"  href="https://developer.mozilla.org/en-US/docs/SpiderMonkey" target="_blank">SpiderMonkey</a>的（Firefox）的<a onclick="javascript:pageTracker._trackPageview('/outgoing/my.opera.com/ODIN/blog/carakan-faq');"  href="http://my.opera.com/ODIN/blog/carakan-faq" target="_blank">Carakan</a>（Opera），<a onclick="javascript:pageTracker._trackPageview('/outgoing/en.wikipedia.org/wiki/Chakra_(JScript_engine)');"  href="http://en.wikipedia.org/wiki/Chakra_(JScript_engine)">Chakra</a>（IE）或其他引擎，这样做可以帮助你<strong>更好地优化你的应用程序</strong>。这并不是说应该专门为某一浏览器或引擎做优化，千万别这么做。</p>
<p>但是，你应该问自己几个问题：</p>
<ul>
<li>在我的代码里，是否可以使代码更高效一些</li>
<li>主流的JavaScript引擎都做了哪些优化</li>
<li>什么是引擎无法优化的，垃圾回收器（GC）是否能回收我所期望的东西</li>
</ul>
<p style="text-align: center;"><img class="aligncenter lh_lazyimg" src="http://www.alloyteam.com/wp-content/plugins/images-lazyload-and-slideshow/blank_1x1.gif" file="http://media.smashingmagazine.com/wp-content/uploads/2012/10/fast_memory.jpg" alt="Dashboard Speedometer" width="510" height="337" /><noscript><img class="aligncenter" src="http://media.smashingmagazine.com/wp-content/uploads/2012/10/fast_memory.jpg" alt="Dashboard Speedometer" width="510" height="337" /></noscript></p>
<p style="text-align: center;"><em>加载</em><em>快速的网站就像是一辆快速的跑车，需要用到特别定制的零件. 图片来源: <a onclick="javascript:pageTracker._trackPageview('/outgoing/dhybridcars.com/toyota-hybrid/2013-scion-fr-s-sexy-sport-car/media/2013-scion-fr-s-speed-gauge-img-8/');"  href="http://dhybridcars.com/toyota-hybrid/2013-scion-fr-s-sexy-sport-car/media/2013-scion-fr-s-speed-gauge-img-8/">dHybridcars</a>.</em></p>
<p style="text-align: left;">编写高性能代码时有一些常见的陷阱，在这篇文章中，我们将展示一些经过验证的、更好的编写代码方式。</p>
<h2 style="text-align: left;"><strong>那么，JavaScript在V8里是如何工作的？</strong></h2>
<p style="text-align: left;">如果你对JS引擎没有较深的了解，开发一个大型Web应用也没啥问题，就好比会开车的人也只是看过引擎盖而没有看过车盖内的引擎一样。鉴于Chrome是我的浏览器首选，所以谈一下它的JavaScript引擎。V8是由以下几个核心部分组成：</p>
<ul>
<li><strong>一个基本的编译器</strong>，它会在代码执行前解析JavaScript代码并生成本地机器码，而不是执行字节码或简单地解释它。这些代码最开始并不是高度优化的。</li>
<li>V8将对象构建为<strong>对象模型</strong>。在JavaScript中对象表现为关联数组，但是在V8中对象被看作是隐藏的类，一个为了优化查询的内部类型系统。</li>
<li><strong>运行时分析器</strong>监视正在运行的系统，并标识了“hot”的函数（例如花费很长时间运行的代码）。</li>
<li><strong>优化编译器</strong>重新编译和优化那些被运行时分析器标识为“hot”的代码，并进行“内联”等优化（例如用被调用者的主体替换函数调用的位置）。</li>
<li>V8支持<strong>去优化</strong>，这意味着优化编译器如果发现对于代码优化的假设过于乐观，它会舍弃优化过的代码。</li>
<li>V8有个<strong>垃圾收集器</strong>，了解它是如何工作的和优化JavaScript一样重要。</li>
</ul>
<h2><strong>垃圾回收</strong></h2>
<p>垃圾回收是<strong>内存管理的一种形式</strong>，其实就是一个收集器的概念，尝试回收不再被使用的对象所占用的内存。在JavaScript这种垃圾回收语言中，应用程序中仍在被引用的对象不会被清除。</p>
<p>手动消除对象引用在大多数情况下是没有必要的。通过简单地把变量放在需要它们的地方（理想情况下，尽可能是局部作用域，即它们被使用的函数里而不是函数外层），一切将运作地很好。</p>
<p><img class="aligncenter lh_lazyimg" src="http://www.alloyteam.com/wp-content/plugins/images-lazyload-and-slideshow/blank_1x1.gif" file="http://media.smashingmagazine.com/wp-content/uploads/2012/10/robot-cleaner.jpg" alt="Garbage collection attempts to reclaim memory." width="405" height="369" /><noscript><img class="aligncenter" src="http://media.smashingmagazine.com/wp-content/uploads/2012/10/robot-cleaner.jpg" alt="Garbage collection attempts to reclaim memory." width="405" height="369" /></noscript></p>
<p style="text-align: center;"><em>垃圾回收器尝试回收内存. 图片来源: <a onclick="javascript:pageTracker._trackPageview('/outgoing/www.flickr.com/photos/26817893@N05/2864644153/');"  href="http://www.flickr.com/photos/26817893@N05/2864644153/">Valtteri Mäki</a>.</em></p>
<p style="text-align: left;">在JavaScript中，是不可能强制进行垃圾回收的。你不应该这么做，因为垃圾收集过程是由运行时控制的，它知道什么是最好的清理时机。</p>
<h3 style="text-align: left;"><strong>“消除引用”的误解</strong></h3>
<p style="text-align: left;">网上有许多关于JavaScript内存回收的讨论都谈到delete这个关键字，虽然它可以被用来删除对象（map）中的属性（key），但有部分开发者认为它可以用来强制“消除引用”。建议尽可能避免使用delete，在下面的例子中<code>delete o.x 的弊大于利，因为它改变了o的隐藏类，并使它成为一个"慢对象"。</code></p>
<pre class="brush: js; title: JavaScript">var o = { x: 1 }; 
delete o.x; // true 
o.x; // undefined</pre>
<p style="text-align: left;">你会很容易地在流行的JS库中找到引用删除——这是具有语言目的性的。这里需要注意的是避免在运行时修改&#8221;hot&#8221;对象的结构。JavaScript引擎可以检测出这种“hot”的对象，并尝试对其进行优化。如果对象在生命周期中其结构没有较大的改变，引擎将会更容易优化对象，而delete操作实际上会触发这种较大的结构改变，因此不利于引擎的优化。</p>
<p style="text-align: left;">对于null是如何工作也是有误解的。将一个对象引用设置为null，并没有使对象变“空”，只是将它的引用设置为空而已。使用o.x= null比使用delete会更好些，但可能也不是很必要。</p>
<pre class="brush: js; title: JavaScript">var o = { x: 1 }; 
o = null;
o; // null
o.x // TypeError</pre>
<p style="text-align: left;">如果此引用是当前对象的最后引用，那么该对象将被作为垃圾回收。如果此引用不是当前对象的最后引用，则该对象是可访问的且不会被垃圾回收。</p>
<p style="text-align: left;">另外需要注意的是，全局变量在页面的生命周期里是不被垃圾回收器清理的。无论页面打开多久，JavaScript运行时全局对象作用域中的变量会一直存在。</p>
<pre class="brush: js; title: JavaScript">var myGlobalNamespace = {};</pre>
<p style="text-align: left;">全局对象只会在刷新页面、导航到其他页面、关闭标签页或退出浏览器时才会被清理。函数作用域的变量将在超出作用域时被清理，即退出函数时，已经没有任何引用，这样的变量就被清理了。</p>
<h3 style="text-align: left;">经验法则</h3>
<p style="text-align: left;">为了使垃圾回收器尽早收集尽可能多的对象，<strong>不要hold着不再使用的对象</strong>。这里有几件事需要记住：</p>
<ul>
<li>正如前面提到的，在合适的范围内使用变量是手动消除引用的更好选择。即一个变量只在一个函数作用域中使用，就不要在全局作用域声明它。这意味着更干净省心的代码。</li>
<li>确保解绑那些不再需要的事件监听器，尤其是那些即将被销毁的DOM对象所绑定的事件监听器。</li>
<li>如果使用的数据缓存在本地，确保清理一下缓存或使用老化机制，以避免大量不被重用的数据被存储。</li>
</ul>
<h3>函数</h3>
<p>接下来，我们谈谈函数。正如我们已经说过，垃圾收集的工作原理，是通过回收不再是访问的内存块（对象）。为了更好地说明这一点，这里有一些例子。</p>
<pre class="brush: js; title: JavaScript">function foo() {
    var bar = new LargeObject();
    bar.someCall();
}</pre>
<p>当foo返回时，bar指向的对象将会被垃圾收集器自动回收，因为它已没有任何存在的引用了。</p>
<p>对比一下：</p>
<pre class="brush: js; title: JavaScript">function foo() {
    var bar = new LargeObject();
    bar.someCall();
    return bar;
}

// somewhere else
var b = foo();</pre>
<p>现在我们有一个引用指向bar对象，这样bar对象的生存周期就从foo的调用一直持续到调用者指定别的变量b（或b超出范围）。</p>
<h3>闭包（CLOSURES）</h3>
<p>当你看到一个函数，返回一个内部函数，该内部函数将获得范围外的访问权，即使在外部函数执行之后。这是一个基本的<a onclick="javascript:pageTracker._trackPageview('/outgoing/robertnyman.com/2008/10/09/explaining-javascript-scope-and-closures/');"  href="http://robertnyman.com/2008/10/09/explaining-javascript-scope-and-closures/" target="_blank">闭包</a> —— 可以在特定的上下文中设置的变量的表达式。例如：</p>
<pre class="brush: js; title: JavaScript">function sum (x) {
    function sumIt(y) {
        return x + y;
    };
    return sumIt;
}

// Usage
var sumA = sum(4);
var sumB = sumA(3);
console.log(sumB); // Returns 7</pre>
<p>在sum调用上下文中生成的函数对象（sumIt）是无法被回收的，它被全局变量（sumA）所引用，并且可以通过sumA(n)调用。</p>
<p>让我们来看看另外一个例子，这里我们可以访问变量largeStr吗？</p>
<pre class="brush: js; title: JavaScript">var a = function () {
    var largeStr = new Array(1000000).join('x');
    return function () {
        return largeStr;
    };
}();</pre>
<p>是的，我们可以通过a()访问largeStr，所以它没有被回收。下面这个呢？</p>
<pre class="brush: js; title: JavaScript">var a = function () {
    var smallStr = 'x';
    var largeStr = new Array(1000000).join('x');
    return function (n) {
        return smallStr;
    };
}();</pre>
<p>我们不能再访问largeStr了，它已经是垃圾回收候选人了。【译者注：因为largeStr已不存在外部引用了】</p>
<h3>定时器</h3>
<p>最糟的内存泄漏地方之一是在循环中，或者在setTimeout()/ setInterval()中，但这是相当常见的。思考下面的例子:</p>
<pre class="brush: js; title: JavaScript">var myObj = {
    callMeMaybe: function () {
        var myRef = this;
        var val = setTimeout(function () { 
            console.log('Time is running out!'); 
            myRef.callMeMaybe();
        }, 1000);
    }
};</pre>
<p>如果我们运行myObj.callMeMaybe();来启动定时器，可以看到控制台每秒打印出“Time is running out!”。如果接着运行<code>myObj = </code><code>null，定时器依旧处于激活状态。为了能够持续执行，闭包将myObj传递给setTimeout，这样myObj是无法被回收的。相反，它引用到myObj的因为它捕获了myRef。这跟我们为了保持引用将闭包传给其他的函数是一样的。</code></p>
<p>同样值得牢记的是，setTimeout/setInterval调用(如函数)中的引用，将需要执行和完成，才可以被垃圾收集。</p>
<h2>当心性能陷阱</h2>
<p>永远不要优化代码，直到你真正需要。现在经常可以看到一些基准测试，显示N比M在V8中更为优化，但是在模块代码或应用中测试一下会发现，这些优化真正的效果比你期望的要小的多。</p>
<p style="text-align: center;"><img class="aligncenter lh_lazyimg" title="Speed Trap" src="http://www.alloyteam.com/wp-content/plugins/images-lazyload-and-slideshow/blank_1x1.gif" file="http://media.smashingmagazine.com/wp-content/uploads/2012/10/speed-trap.jpg" alt="Speed trap." width="450" height="315" /><noscript><img class="aligncenter" title="Speed Trap" src="http://media.smashingmagazine.com/wp-content/uploads/2012/10/speed-trap.jpg" alt="Speed trap." width="450" height="315" /></noscript></p>
<p style="text-align: center;"><em>做的过多还不如什么都不做. 图片来源: <a onclick="javascript:pageTracker._trackPageview('/outgoing/www.flickr.com/photos/tim_uk/7717078488/sizes/c/in/photostream/');"  href="http://www.flickr.com/photos/tim_uk/7717078488/sizes/c/in/photostream/">Tim Sheerman-Chase</a>.</em></p>
<p style="text-align: left;">比如我们想要创建这样一个模块：</p>
<ul>
<li>需要一个本地的数据源包含数字ID</li>
<li>绘制包含这些数据的表格</li>
<li>添加事件处理程序，当用户点击的任何单元格时切换单元格的css class</li>
</ul>
<p>这个问题有几个不同的因素，虽然也很容易解决。我们如何存储数据，如何高效地绘制表格并且append到DOM中，如何更优地处理表格事件？</p>
<p>面对这些问题最开始（天真）的做法是使用对象存储数据并放入数组中，使用jQuery遍历数据绘制表格并append到DOM中，最后使用事件绑定我们期望地点击行为。</p>
<p><strong>注意：这不是你应该做的</strong></p>
<pre class="brush: js; title: JavaScript">var moduleA = function () {

    return {

        data: dataArrayObject,

        init: function () {
            this.addTable();
            this.addEvents();
        },

        addTable: function () {

            for (var i = 0; i &lt; rows; i++) {
                $tr = $('&lt;tr&gt;&lt;/tr&gt;');
                for (var j = 0; j &lt; this.data.length; j++) {
                    $tr.append('&lt;td&gt;' + this.data[j]['id'] + '&lt;/td&gt;');
                }
                $tr.appendTo($tbody);
            }

        },
        addEvents: function () {
            $('table td').on('click', function () {
                $(this).toggleClass('active');
            });
        }

    };
}();</pre>
<p>这段代码简单有效地完成了任务。</p>
<p>但在这种情况下，我们遍历的数据只是本应该简单地存放在数组中的数字型属性ID。有趣的是，直接使用DocumentFragment和本地DOM方法比使用jQuery（以这种方式）来生成表格是更优的选择，当然，事件代理比单独绑定每个td具有更高的性能。</p>
<p>要注意虽然jQuery在内部使用DocumentFragment，但是在我们的例子中，代码在循环内调用append并且这些调用涉及到一些其他的小知识，因此在这里起到的优化作用不大。希望这不会是一个痛点，但请务必进行基准测试，以确保自己代码ok。</p>
<p>对于我们的例子，上述的做法带来了（期望的）性能提升。事件代理对简单的绑定是一种改进，可选的DocumentFragment也起到了助推作用。</p>
<pre class="brush: js; title: JavaScript">var moduleD = function () {

    return {

        data: dataArray,

        init: function () {
            this.addTable();
            this.addEvents();
        },
        addTable: function () {
            var td, tr;
            var frag = document.createDocumentFragment();
            var frag2 = document.createDocumentFragment();

            for (var i = 0; i &lt; rows; i++) {
                tr = document.createElement('tr');
                for (var j = 0; j &lt; this.data.length; j++) {
                    td = document.createElement('td');
                    td.appendChild(document.createTextNode(this.data[j]));

                    frag2.appendChild(td);
                }
                tr.appendChild(frag2);
                frag.appendChild(tr);
            }
            tbody.appendChild(frag);
        },
        addEvents: function () {
            $('table').on('click', 'td', function () {
                $(this).toggleClass('active');
            });
        }

    };

}();</pre>
<p>接下来看看其他提升性能的方式。你也许曾经在哪读到过使用原型模式比模块模式更优，或听说过使用JS模版框架性能更好。有时的确如此，不过使用它们其实是为了代码更具可读性。对了，还有预编译！让我们看看在实践中表现的如何？</p>
<pre class="brush: js; title: JavaScript">moduleG = function () {};

moduleG.prototype.data = dataArray;
moduleG.prototype.init = function () {
    this.addTable();
    this.addEvents();
};
moduleG.prototype.addTable = function () {
    var template = _.template($('#template').text());
    var html = template({'data' : this.data});
    $tbody.append(html);
};
moduleG.prototype.addEvents = function () {
   $('table').on('click', 'td', function () {
       $(this).toggleClass('active');
   });
};

var modG = new moduleG();</pre>
<p>事实证明，在这种情况下的带来的性能提升可以忽略不计。<a onclick="javascript:pageTracker._trackPageview('/outgoing/jsperf.com/second-pass');"  href="http://jsperf.com/second-pass" target="_blank">模板和原型的选择</a>并没有真正提供更多的东西。也就是说，性能并不是开发者使用它们的原因，给代码带来的可读性、继承模型和可维护性才是真正的原因。</p>
<p>更复杂的问题包括<a onclick="javascript:pageTracker._trackPageview('/outgoing/jsperf.com/canvas-drawimage-vs-webgl-drawarrays/6');"  href="http://jsperf.com/canvas-drawimage-vs-webgl-drawarrays/6" target="_blank">高效地在canvas上绘制图片</a>和操作带或不带类型数组的像素数据。</p>
<p>在将一些方法用在你自己的应用之前，一定要多了解这些方案的基准测试。也许有人还记得<a onclick="javascript:pageTracker._trackPageview('/outgoing/jsperf.com/dom-vs-innerhtml-based-templating/473');"  href="http://jsperf.com/dom-vs-innerhtml-based-templating/473" target="_blank">JS模版的shoot-off</a>和<a onclick="javascript:pageTracker._trackPageview('/outgoing/jsperf.com/javascript-templating-shootoff-extended/26');"  href="http://jsperf.com/javascript-templating-shootoff-extended/26" target="_blank">随后的扩展版</a>。你要搞清楚基准测试不是存在于你看不到的那些虚拟应用，而是应该在你的实际代码中去测试带来的优化。</p>
<h2>V8优化技巧</h2>
<p>详细介绍了每个V8引擎的优化点在本文讨论范围之外，当然这里也有许多值得一提的技巧。记住这些技巧你就能减少那些性能低下的代码了。</p>
<ul>
<li>特定模式可以使V8摆脱优化的困境，比如说try-catch。欲了解更多有关哪些函数能或不能进行优化，你可以在V8的脚本工具d8中使用&#8211;trace-opt file.js命令。</li>
<li>如果你关心速度，尽量使你的函数职责单一，即确保变量（包括属性，数组，函数参数）只使用相同隐藏类包含的对象。举个例子，别这么干：
<pre class="brush: js; title: JavaScript">function add(x, y) { 
   return x+y;
} 

add(1, 2); 
add('a','b'); 
add(my_custom_object, undefined);</pre>
</li>
<li>不要加载未初始化或已删除的元素。如果这么做也不会出现什么错误，但是这样会使速度变慢。</li>
<li>不要使函数体过大，这样会使得优化更加困难。</li>
</ul>
<p>更多内容可以去看Daniel Clifford在Google I/O的分享 <a onclick="javascript:pageTracker._trackPageview('/outgoing/www.youtube.com/watch?v=UJPdhx5zTaw');"  href="http://www.youtube.com/watch?v=UJPdhx5zTaw">Breaking the JavaScript Speed Limit with V8</a>。 <a onclick="javascript:pageTracker._trackPageview('/outgoing/floitsch.blogspot.co.uk/2012/03/optimizing-for-v8-introduction.html');"  href="http://floitsch.blogspot.co.uk/2012/03/optimizing-for-v8-introduction.html">Optimizing For V8 — A Series</a>也非常值得一读。</p>
<h3>对象VS数组：我应该用哪个？</h3>
<ul>
<li>如果你想存储一串数字，或者一些相同类型的对象，使用一个数组。</li>
<li>如果你语义上需要的是一堆的对象的属性（不同类型的），使用一个对象和属性。这在内存方面非常高效，速度也相当快。</li>
<li>整数索引的元素，无论存储在一个数组或对象中，都要<a onclick="javascript:pageTracker._trackPageview('/outgoing/jsperf.com/performance-of-array-vs-object/3');"  href="http://jsperf.com/performance-of-array-vs-object/3" target="_blank">比遍历对象的属性快得多</a>。</li>
<li>对象的属性比较复杂：它们可以被setter们创建，具有不同的枚举性和可写性。数组中则不具有如此的定制性，而只存在有和无这两种状态。在引擎层面，这允许更多存储结构方面的优化。特别是当数组中存在数字时，例如当你需要容器时，不用定义具有x,y,z属性的类，而只用数组就可以了。</li>
</ul>
<p>JavaScript中对象和数组之间只有一个的主要区别，那就是数组神奇的length属性。如果你自己来维护这个属性，那么V8中对象和数组的速度是一样快的。</p>
<h3>使用对象时的技巧</h3>
<ul>
<li>使用一个构造函数来创建对象。这将确保它创建的所有对象具有相同的隐藏类，并有助于避免更改这些类。作为一个额外的好处，它也<a onclick="javascript:pageTracker._trackPageview('/outgoing/jsperf.com/object-create-vs-constructor-vs-object-literal/7');"  href="http://jsperf.com/object-create-vs-constructor-vs-object-literal/7" target="_blank">略快于Object.create()</a></li>
<li>你的应用中，对于使用不同类型的对象和其复杂度（在合理的范围内：长原型链往往是有害的，呈现只有一个极少数属性的对象比大对象会快一点）是有没限制的。对于“hot”对象，尽量保持短原型链，并且少属性。</li>
</ul>
<h4>对象克隆</h4>
<p>对于应用程序开发人员，对象克隆是一个常见的问题。虽然各种基准测试可以证明V8对这个问题处理得很好，但仍要小心。复制大的东西通常是较慢的——不要这么做。JS中的for..in循环尤其糟糕，因为它有着恶魔般的规范，并且无论是在哪个引擎中，都可能永远不会比任何对象快。</p>
<p>当你一定要在关键性能代码路径上复制对象时，使用数组或一个自定义的“拷贝构造函数”功能明确地复制每个属性。这可能是最快的方式：</p>
<pre class="brush: js; title: JavaScript">function clone(original) {
  this.foo = original.foo;
  this.bar = original.bar;
}
var copy = new clone(original);</pre>
<h4>模块模式中缓存函数</h4>
<p>使用模块模式时缓存函数，可能会导致性能方面的提升。参阅下面的例子，因为它总是创建成员函数的新副本，你看到的变化可能会比较慢。</p>
<p>另外请注意，使用这种方法明显更优，不仅仅是依靠原型模式（经过jsPerf测试确认）。</p>
<p><img class="aligncenter lh_lazyimg" src="http://www.alloyteam.com/wp-content/plugins/images-lazyload-and-slideshow/blank_1x1.gif" file="http://media.smashingmagazine.com/wp-content/uploads/2012/11/Screen-Shot-2012-11-06-at-10.42.10.png" alt="Performance improvements" width="648" height="471" /><noscript><img class="aligncenter" src="http://media.smashingmagazine.com/wp-content/uploads/2012/11/Screen-Shot-2012-11-06-at-10.42.10.png" alt="Performance improvements" width="648" height="471" /></noscript></p>
<p style="text-align: center;"><em>使用模块模式或原型模式时的性能提升</em></p>
<p style="text-align: left;">这是一个<a onclick="javascript:pageTracker._trackPageview('/outgoing/jsperf.com/prototypal-performance/12');"  href="http://jsperf.com/prototypal-performance/12" target="_blank">原型模式与模块模式的性能对比测试</a>：</p>
<pre class="brush: js; title: JavaScript">  // Prototypal pattern
  Klass1 = function () {}
  Klass1.prototype.foo = function () {
      log('foo');
  }
  Klass1.prototype.bar = function () {
      log('bar');
  }

  // Module pattern
  Klass2 = function () {
      var foo = function () {
          log('foo');
      },
      bar = function () {
          log('bar');
      };

      return {
          foo: foo,
          bar: bar
      }
  }

  // Module pattern with cached functions
  var FooFunction = function () {
      log('foo');
  };
  var BarFunction = function () {
      log('bar');
  };

  Klass3 = function () {
      return {
          foo: FooFunction,
          bar: BarFunction
      }
  }

  // Iteration tests

  // Prototypal
  var i = 1000,
      objs = [];
  while (i--) {
      var o = new Klass1()
      objs.push(new Klass1());
      o.bar;
      o.foo;
  }

  // Module pattern
  var i = 1000,
      objs = [];
  while (i--) {
      var o = Klass2()
      objs.push(Klass2());
      o.bar;
      o.foo;
  }

  // Module pattern with cached functions
  var i = 1000,
      objs = [];
  while (i--) {
      var o = Klass3()
      objs.push(Klass3());
      o.bar;
      o.foo;
  }
// See the test for full details</pre>
<h3>使用数组时的技巧</h3>
<p>接下来说说数组相关的技巧。在一般情况下，<strong>不要删除数组元素</strong>，这样将使数组过渡到较慢的内部表示。当索引变得稀疏，V8将会使元素转为更慢的字典模式。</p>
<h4>数组字面量</h4>
<p>数组字面量非常有用，它可以暗示VM数组的大小和类型。它通常用在体积不大的数组中。</p>
<pre class="brush: js; title: JavaScript">// Here V8 can see that you want a 4-element array containing numbers:
var a = [1, 2, 3, 4];

// Don't do this:
a = []; // Here V8 knows nothing about the array
for(var i = 1; i &lt;= 4; i++) {
     a.push(i);
}</pre>
<h4>存储单一类型VS多类型</h4>
<p>将混合类型（比如数字、字符串、undefined、true/false）的数据存在数组中绝不是一个好想法。例如var arr = [1, “1”, undefined, true, “true”]</p>
<p><a onclick="javascript:pageTracker._trackPageview('/outgoing/jsperf.com/type-inference-performance/2');"  href="http://j