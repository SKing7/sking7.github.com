<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Javascript UUID Function</title>
<link rel="stylesheet" href="../css/article.css" />
</head>
<body>
<div class="m-content">
<h1>Javascript UUID Function</h1>
<div class="entry-content"><span>
		</span><p>[<strong>UPDATE – 1/3/2010</strong>: For the latest/greatest implementation of a JavaScript UUID function, please check out my <a href="https://github.com/broofa/node-uuid">node-uuid</a> project. &nbsp;Any future improvements/enhancements to this code will be made there.]</p><span>
</span><p>[<strong>UPDATE – 9/1/2011</strong>: ‘Seeing reports of UUID collisions <a href="http://goo.gl/asck6">in the wild</a>. &nbsp;Johannes Baagoe has a write up on why <a href="http://baagoe.com/en/RandomMusings/javascript/">Math.random() can’t be trusted</a>. &nbsp;I’m not entirely sure I buy this, but I’m certainly less confident than before about the uniqueness of UUIDs generated using only Math.random().]</p><span>
</span><p>Here’s a little JavaScript treat: <a href="http://www.broofa.com/Tools/Math.uuid.js">Math.uuid.js</a> is a function for generating different flavors of UUIDs in JavaScript. The function supports RFC 4122-compliant UUIDs (or GUIDS), like this:</p><span>
</span><blockquote><p><code>AFF147E4-5BB1-448E-B55D-0A834ADE3124</code></p></blockquote><span>
</span><p>… as well as non-standard random IDs of arbitrary length and radix. For examples of the types of IDs it can generate, or to see performance data, check out the <a href="http://www.broofa.com/Tools/Math.uuid.htm">Math.uuid.js Test page</a>.</p><span>
</span><p>I put this together after discovering that nobody had published a really thin javascript implementation for generating UUIDs. Googling around turns up <a href="http://lists.evolt.org/pipermail/javascript/2006-July/010716.html">several</a> <a href="http://www.af-design.com/services/javascript/uuid/">decent</a> <a href="http://openjsan.org/doc/j/jc/jcap/Dojo/common/0.4.1/lib/src/uuid/Uuid.html">scripts</a>, but all of these suffered from one drawback or another (IMHO). One common problem results from trying to produce “version 1″ ids, which the RFC defines in a way that is supposed to guarantee the uniqueness of the ID. But javascript doesn’t have an API for getting a guaranteed-unique <em>anything</em> – the best you can do is use Math.random() as a <span>hack</span> workaround which, strictly speaking, shouldn’t be used when uniqueness must be guaranteed. Using JavaScript to generate a version 1 UUID could be construed as misleading.</p><span>
</span><p>The more correct solution is to do what Math.uuid.js does – create “version 4″ ids, which are defined as randomly generated (see <a href="http://www.ietf.org/rfc/rfc4122.txt">RFC 4122</a>, section 4.4). This avoids making an unfulfilled promise of universal uniqueness, while allowing for much simpler code. Also, in javascript where Math.random() has to be used for UUID generation, the theoretical uniqueness of these ids is better than version 1 implementations since all 122 bits of field data are randomly generated. That makes for a staggering 5.3 x 10^^36 possible ids. If every person on the planet filled up a terabyte hard drive with nothing but random UUIDs, there would only be a one in 7 <em>trillion</em> chance that two of the UUIDs would be the same. That’s the theory.</p><span>
</span><p>The practice is probably a little different. The uniqueness depends on how random the numbers generated by Math.random() are. Generating truly random numbers is a <a href="http://en.wikipedia.org/wiki/Pseudorandom_number_generator">notoriously tricky problem</a>, solved in different (imperfect) ways across browser platforms and OSes. It’s difficult to say for sure what the real-world uniqueness of these numbers ends up being, but I suspect it’s more than sufficient for most purposes. Regardless, this is a weakness that all javascript UUID generators will be subject to, unless they rely on an externally-provided unique value. For example, one could use AJAX to fetch UUIDs generated by a site like <a href="http://www.uuidgenerator.com/">http://www.uuidgenerator.com/</a>, but that has it’s own set of issues.</p><span>
</span><p><strong>Update 1/22/10</strong>: Math.uuid.js includes an Math.uuid2&nbsp;Math.uuidCompact – an alternate implementation for RFC4122v4 UUIDs designed to be as compact as possible, and Math.uuidFast() – an implementation designed for performance.</p><span>
</span><p><strong>Update 06/03/10</strong>: Several people have expressed concern over how random the Math.random() method is. (E.g. “If two clients load the random() lib at the same time, will they start with the same seed?”) After doing a bit of research into&nbsp;<a href="http://en.wikipedia.org/wiki/Entropy_(computing)#Entropy_in_OS.2F2">how various OSes handle random # generation</a> , I’m pretty satisfied that this unlikely to be an issue. &nbsp;Seeding is done from a variety of sources of almost pure random numbers – mouse movement, built-in hardware support (e.g. by measuring noise in electrical circuits), various unique device IDs, BIOS checksums, memory usage statistics… and so on.</p><span>
	</span></div></div>
<script>var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-34802167-1']); _gaq.push(['_setDomainName', 'liuzhe.co']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();</script></body>
</html>