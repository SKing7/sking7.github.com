<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Transparent WebP format CDN delivery based on visitors' browsers</title>
<link rel="stylesheet" href="../css/article.css" />
</head>
<body>
<div class="m-content">
<h1>Transparent WebP format CDN delivery based on visitors' browsers</h1>
<div><div><img src="http://res.cloudinary.com/cloudinary/image/upload/w_0.6/webp_cloud_post_rvltqi.png" alt="Cloud-based WebP Delivery" width="180" height="180" /><p style="display: inline;">One of the hardest optimization goals when showing images to your website (and mobile application's) visitors, is to minimize the image file size while maintaining high enough display quality.</p></div><p>Smaller image file sizes directly translate to faster load times, reduced bandwidth costs and improved user browsing experience. But small file sizes directly translate to lower image quality and may harm visitor satisfaction. Maintaining just the right balance is both crucial and hard.</p><p>As a result, it's quite rare to find a solution that reduces image file sizes without sacrificing image quality. Fortunately, this is exactly the case with <strong>Google's WebP image format</strong>.</p><p>WebP is a powerful image format that was first introduced by Google in 2010. Using advanced compression techniques, the WebP format encodes photos using files significantly smaller than the popular JPEG (lossy) and PNG (lossless) image formats.</p><p>But if it's such an amazing image format, why don't we see it in every website out there? The main setback to a widespread WebP image format adoption is that it's not (yet) widely supported by even the most modern web browsers.&nbsp;</p><p>While Google's popular <strong>Chrome</strong> web browser and the <strong>Opera</strong> browser natively support WebP, Firefox and Internet Explorer do not. As a result, supporting WebP requires messing around with dynamically deciding whether to deliver WebP format or JPG/PNG images according to the browser used by each of your visitors.</p><div><p style="display: inline;">A few weeks ago we introduced Cloudinary's support for the WebP format: </p><a href="http://cloudinary.com/blog/how_to_support_webp_images_save_bandwidth_and_improve_user_performance"><strong>How to support WebP images, save bandwidth and improve user performance</strong></a><p style="display: inline;">. In that article, we described how you can set Cloudinary's jQuery plugin to check whether the browser supports WebP, and if so, tell Cloudinary to dynamically generate and deliver WebP files instead of standard JPG/PNG ones.</p></div><p>While the jQuery lazy-loading client-side approach has its advantages, it could have been much simpler if this entire logic was handled <strong>transparently</strong> for you on the server side. This is exactly what we've been working on in the past few weeks.</p><p>In this blog post we wanted to introduce <span><strong>Cloudinary's seamless support for dynamic delivery of WebP images</strong></span>.</p><h3>Enabling automatic WebP delivery<span>&nbsp;</span>
</h3><p>Cloudinary can now identify when an image URL was requested by a browser that supports WebP. In such a case, Cloudinary will automatically convert your image, on-the-fly, to the WebP format and deliver it cached and optimized through <strong>Akamai's CDN</strong>.&nbsp;</p><p>To leverage this capability, and tell Cloudinary to automatically use WebP when applicable, all you need to do is add '<strong><span>f_auto</span></strong>' (Format = Auto) to Cloudinary’s smart delivery URLs.</p><p>Below you can see two sample images. The image on the left uses a URL without Cloudinary's new 'f_auto' flag and is therefore delivered in JPG format across all browsers (while being scaled on-the-fly to 300px width with its aspect ratio retained). The image on the right includes 'f_auto' in its delivery URL and so delivered as WebP if you are using Google Chrome. The resulting WebP image weighs only <strong>6.9KB</strong>, which is <strong>60% smaller</strong> than its counterpart JPEG version delivered to our Firefox, Safari and IE visitors.</p><a href="http://res.cloudinary.com/demo/image/upload/w_300/nice_beach.jpg" target="_blank"><img src="http://res.cloudinary.com/demo/image/upload/w_300/nice_beach.jpg" alt="JPG Image" width="300" height="201" /></a><a href="http://res.cloudinary.com/demo/image/upload/w_300,f_auto/nice_beach.jpg" target="_blank"><img src="http://res.cloudinary.com/demo/image/upload/w_300,f_auto/nice_beach.jpg" alt="WebP Automatic Image" width="300" height="201" /></a><p><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16.9KB JPG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6.9KB WebP (or 16.9KB JPG)</span></p><p>That's it. This little addition is all you need for your web application to load faster and save significant bandwidth costs. This is especially true if your website caters to "techies" that statistically use Chrome much more than others :)</p><p><strong>Notes:</strong></p><div><ul>
<li>Pasting a URL with 'f_auto' in your Chrome's address bar will always return a JPG image. The automatic WebP delivery only works for images embedded in HTML pages.</li>
<li>‘f_auto’ is only supported for Cloudinary users that use our Akamai CDN delivery. It is currently not supported for users with a dedicated CloudFront distribution.</li>
<li>For our transparent WebP support to work, the delivery URL has to explicitly include 'f_auto’. Therefore, you can't set the fetch format to 'auto' inside of a named transformation. Instead, you can use a named transformation while chaining 'f_auto' to the URL.</li>
</ul></div><h3>Enabling WebP delivery programmatically<span>&nbsp;</span>
</h3><p>Cloudinary's client integration libraries already support the new 'f_auto' &nbsp;feature. Here are a few examples of how to generate such URLs in your favorite development framework:</p><p>Ruby on Rails:</p><div><div><div><div><div><pre><span><span>&lt;%=</span> cl_image_tag(<span><span>"</span><span>sample.jpg</span><span>"</span></span>, <span>:width</span> =&gt; <span>300</span>, <span>:crop</span> =&gt; <span>:scale</span>, <span>:fetch_format</span> =&gt; <span>:auto</span>) <span>%&gt;</span></span></pre></div></div></div></div></div><p>PHP:</p><div><div><div><div><div><pre><span>&lt;?php</span> <span>echo</span> cl_image_tag(<span><span>"</span><span>sample.jpg</span><span>"</span></span>,
        <span>array</span>(<span><span>"</span><span>width</span><span>"</span></span> =&gt; <span>300</span>, <span><span>"</span><span>crop</span><span>"</span></span> =&gt; <span><span>"</span><span>scale</span><span>"</span></span>, <span><span>"</span><span>fetch_format</span><span>"</span></span> =&gt; <span><span>"</span><span>auto</span><span>"</span></span>)); <span>?&gt;</span></pre></div></div></div></div></div><p>Python &amp; Django:</p><div><div><div><div><div><pre>cloudinary.CloudinaryImage(<span><span>"</span><span>sample.jpg</span><span>"</span></span>).image(width=<span>300</span>, 
   crop=<span><span>"</span><span>scale</span><span>"</span></span>, fetch_format=<span><span>"</span><span>auto</span><span>"</span></span>)</pre></div></div></div></div></div><p>Node.js:</p><div><div><div><div><div><pre>cloudinary.image(<span><span>"</span><span>sample.jpg</span><span>"</span></span>, { <span>width</span>: <span>100</span>, <span>crop</span>: <span><span>"</span><span>scale</span><span>"</span></span>, <span>fetch_format</span>: <span><span>"</span><span>auto</span><span>"</span></span> })</pre></div></div></div></div></div><p>.Net:</p><div><div><div><div><div><pre>cloudinary.Api.UrlImgUp.Transform(
<span>&nbsp;</span> <span>new</span> Transformation().Width(<span>300</span>).Height(<span>130</span>).Crop(<span><span>"</span><span>scale</span><span>"</span></span>).FetchFormat(<span><span>"</span><span>auto</span><span>"</span></span>)).
<span>&nbsp;</span> <span>&nbsp;</span> BuildImageTag(<span><span>"</span><span>sample.jpg</span><span>"</span></span>);</pre></div></div></div></div></div><p>Java &amp; Android:</p><div><div><div><div><div><pre>cloudinary.url().transformation(
<span>&nbsp;</span> <span>new</span> Transformation().width(<span>300</span>).crop(<span><span>"</span><span>fill</span><span>"</span></span>).fetchFormat(<span><span>'</span><span>auto</span><span>'</span></span>)).
    generate(<span><span>"</span><span>sample.jpg</span><span>"</span></span>);<span>&nbsp;</span></pre></div></div></div></div></div><h3><span><br />Remote fetching of existing images</span></h3><p>So far our examples focused on WebP support for images that were uploaded to Cloudinary first, either using our upload API from your server code or directly from your visitor's browsers.&nbsp;</p><div><p style="display: inline;">In addition to direct uploads, Cloudinary also supports fetching images via their public URLs, manipulating these on-the-fly and delivering the resulting images optimized via a CDN (see </p><a href="http://cloudinary.com/blog/delivering_all_your_websites_images_through_a_cdn" target="_blank">this blog post</a><p style="display: inline;"> for more details).&nbsp;</p></div><p>This means, for example, that you can easily integrate Cloudinary with your website without modifying your infrastructure and code. Simply prefix your image URLs with Cloudinary's fetch URL.</p><p>With Cloudinary's new WebP support, you can now set the fetch format to '<strong>auto</strong>' to dynamically convert images to the WebP format when applicable and improve your site's performance.</p><p>For example, the following URL delivers a picture of Usain Bolt from a remote Wikimedia Commons HTTP URL. The remote image is fetched by Cloudinary, stored persistently in the cloud, dynamically converted to WebP where supported and delivered optimized and cached through a high-end CDN.&nbsp;</p><a href="http://res.cloudinary.com/demo/image/fetch/f_auto/http://upload.wikimedia.org/wikipedia/commons/1/13/Usain_Bolt_16082009_Berlin.JPG" target="_blank"><img src="http://res.cloudinary.com/demo/image/fetch/w_300,f_auto/http://upload.wikimedia.org/wikipedia/commons/1/13/Usain_Bolt_16082009_Berlin.JPG" alt="Usain Bolt - Fetch - WebP" width="300" height="200" /></a><p>Notice that WebP reduced the size of the image above by <strong>50%</strong> <strong>from 33.6KB to 16.8KB</strong> without affecting the display quality in a visible way.</p><p>You can dynamically apply any of Cloudinary's image manipulations on the fetched image. The following example crops the image to a square, makes it lighter in color and rounds its corners:</p><h3>Summary</h3><p>The WebP format is a highly effective way to optimize your sites and apps. With Cloudinary’s WebP support, we hope we’ve made the WebP conversion and delivery process so simple its a no brainer to use, with nearly zero technical effort on your R&amp;D and IT side.</p><p>Automatic WebP conversion and CDN delivery of WebP images is now available for all of our free and paid plans.&nbsp;</p><p>It would be great if you try it out and let us know what you think. Any feedback or suggestion would be highly appreciated!</p></div></div>
<script>var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-34802167-1']); _gaq.push(['_setDomainName', 'liuzhe.co']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();</script></body>
</html>