<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <title></title>
  </head>
  <body>
        <!-- MAIN CONTENT -->
        <div id="main_content_wrap" class="outer">
        <textarea style="visibility:none" id="html-area">





 


<!DOCTYPE html&gt;
<html lang="zh-CN"&gt;
<head&gt;
	<meta charset="utf-8"&gt;
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7, IE=9" /&gt;
	<title&gt;图灵社区 : 阅读 : 从VOA慢速英语的网站上下载Mp3与PDF文本的Python脚本</title&gt;

<link href="/Content/2012/css/style?v=0EAQ_XOLvMkr4D-XN-sUslEuAQV-NvWL60R1FJc2-pA1" rel="stylesheet"/&gt;



<!--[if IE 6]&gt;
<link href="/Content/2012/css/ie6.min.css" rel="stylesheet"&gt;
<![endif]--&gt; 

<script src="/js/frontend?v=WrwLFUrDgS45U5wI2E2GN6NKxBmZFQ9vbPlz1WOeRbw1"&gt;</script&gt;



<!--Le HTML5 shim, for IE6-8 support of HTML5 elements--&gt;
<!--[if lt IE 9]&gt;
<script src="/Content/2012/js/html5.js"&gt;</script&gt;
<![endif]--&gt;
<!--[if IE 6]&gt;
<script src="/Content/2012/js/ie6.min.js"&gt;</script&gt;
<![endif]--&gt;
<!--Le fav and touch icons--&gt;
<link rel="shortcut icon" href="/favicon.ico"&gt;
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/Content/2012/img/icon-touch-114.png"&gt;
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/Content/2012/img/icon-touch-72.png"&gt;
<link rel="apple-touch-icon-precomposed" href="/Content/2012/img/icon-touch-57.png"&gt;

</head&gt;
<body&gt;
	<div id="topnav"&gt;<div class="page"&gt;

	
        <!--Donut#2A7D145623B8E34AA0770ED3EBDF1E541916DD18CEB8431FEB3E45F984FB82AA7740AADCB76F057A767C2EE6BC526EE5473A539CD2001D90D1F637571BBC0C97BA59A2900BE3DB49037AC341568E4D63168E3CBFB0CA53D22575BD1CD3864C47FE814CE562330401D8B3802E3750AD9D206568AA5B4483FF5E664F8E3442A7CAD1BBB45A0378D71D2F5A15BEF3B9299BA4A793F8271C43133C862502720555D8DD17F36FCB0DB2D44AC770C23E0B7FACE170BEBD72AC893CEB2870AFFC6FFC3881DF57D6D003356A2A970491233F5D8A2E2EA933759333BBF6D517829A1DF80206824825F86E6AD41E88A32AF40E89EBC8CF809E986F42CCA501F9ABC0599DA652F68B42E4A5E5795A2D773D770B3FC26C79B10A71C579FA3D7F726FB4CFA16471BCE886B08E1CCD2023EE3824ACDC3C0C776C99B8B26D6C669776882AFC87F3A7C5F6C8E8F564BDC110F1A207AA199121AE1C7031254EA029E29699559000666F1B8CEED74F3CAF756D9CB63E2BBEC0BA90ACC0DE7ED75DF0C17E63AD4B385106E5376C5D104C78860B4A847E3D5A88#--&gt;	<ul id="usermenu"&gt;
		<li&gt;你好！</li&gt;


		<li&gt;<a href="/account/register"&gt;新会员注册</a&gt;</li&gt;
		<li&gt;<a href="/account/logon"&gt;登录</a&gt;</li&gt;

	</ul&gt;
<!--EndDonut--&gt;
    

	</div&gt;</div&gt;
	<div class="page"&gt;
		<div id="header"&gt;
			<a href="/" id="title" title="图灵社区 首页"&gt;◁ 首页</a&gt;
			<div id="menucontainer"&gt;
				<ul id="menu" class="article" &gt;
					
					<form id="nav-search" class="form-search" action="/search" method="get"&gt;
					  <input type="search" id="q" name="q" /&gt;
					  <input type="hidden" id="type" name="type" /&gt;
					  <input type="submit" id="search-btn" value="搜索" /&gt;
					</form&gt;

					<li&gt;<a class="ebooks" href="/book/ebook?sort=updated"&gt;电子书</a&gt;</li&gt;
					<li&gt;<a class="book" href="/book"&gt;图 书</a&gt;</li&gt;
					<li&gt;<a class="article" href="/article?sort=newest"&gt;文 章</a&gt;</li&gt;
					<li&gt;<a class="users" href="/users"&gt;会 员</a&gt;</li&gt;
					<li&gt;<a class="write" href="/users/mywriting"&gt;写 作</a&gt;</li&gt;
				</ul&gt;
			</div&gt;
		</div&gt;
		<div id="main" class="clearfix"&gt;
			



<script type="text/javascript"&gt;

    $(function () {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
    
    function onCloneSuccess(data) {
        alert(data);
    }

    function onDonateSuccess(data) {
        alert(data);

        if (data.substring(0, 4) != "赠银失败") {
            $("#donate_btn").remove();
            $("#donate_info").show();
        }
            
    }
</script&gt;

<div class="row"&gt;
    <div class="span9"&gt;
        <div id="question-header"&gt;
            <h1&gt;
                <a href="/article/50268"&gt;从VOA慢速英语的网站上下载Mp3与PDF文本的Python脚本</a&gt; 
            </h1&gt;
        </div&gt;

        <div class="row"&gt;
            <div class="span1 votecell"&gt;
                <div id="votediv" class="vote"&gt;
    
<a data-ajax="true" data-ajax-begin="$(&#39;#vote-50268&#39;).html(&#39;取消推荐&#39;)" data-ajax-mode="replace" data-ajax-update="#votediv" href="/article/vote/50268" id="vote-50268"&gt;推荐</a&gt;
    <strong&gt;1</strong&gt;

    <a data-ajax="true" data-ajax-begin="$(&#39;#fav-50268&#39;).html(&#39;取消收藏&#39;)" data-ajax-mode="replace" data-ajax-update="#votediv" href="/article/vote/50268?isFave=True" id="fav-50268"&gt;收藏</a&gt;

</div&gt;






            </div&gt;
            <div class="span8"&gt;
                <div class="post-text"&gt;
<p&gt;想通过听写练习来提高自己的英语听力。<a href="http://www.voanews.com/learningenglish/home/"&gt;VOA慢速英语</a&gt;语速很慢（约100－120字/分钟），发音标准清晰，内容丰富（包括新闻、词汇谚语、人物故事等），提供录音及文本下载，是非常不错的入门听写材料。</p&gt;

<p&gt;为什么要写脚本来下载呢？首先，虽然VOA有对应的Podcast节目，更新方便，但下载链接在大陆是无法访问的，只能看到节目有更新，就是无法下载。其次，每天手动到VOA网站上去下载，似乎太傻瓜，这种重复性地工作应该要自动化处理的。</p&gt;

<p&gt;从网页中抓取内容是非常常见的应用，处理流程一般就是下载网页，用正则或其他解析html的工具提取需要的链接，再下载链接内容。在写这个脚本的过程中，遇到并解决了以下几个问题，记录在此。</p&gt;

<ul&gt;
<li&gt;提取节目的下载链接</li&gt;
<li&gt;下载内容时显示进度条</li&gt;
<li&gt;保证文件能够完全下载，避免重复下载</li&gt;
<li&gt;使用Socks代理来解决GFW的问题</li&gt;
</ul&gt;

<h2&gt;提取节目的下载链接</h2&gt;

<p&gt;需要获取3个数据：节目标题、节目PDF链接、节目Mp3链接。</p&gt;

<p&gt;VOS慢速英语除了Podcast外，还提供了RSS订阅，可以直接解析RSS内容来获取Mp3的下载链接；但是RSS输出中没有PDF文本的链接，所以我选择了直接拉取web页面，用正则来提取内容。</p&gt;

<p&gt;VOA慢速英语目前有7个主题，在每个主题自己的页面可以看到当月更新的节目（我没有找到可以列出所有节目的页面）。在每期节目自己的页面中，可以找到PDF的下载链接；但是Mp3的链接还需要进入在线收听页面才能找到。</p&gt;

<p&gt;这是<a href="http://learningenglish.voanews.com/programindex.html"&gt;主题列表页面</a&gt;部分截图：<img src="/download/01YZBHPoDwDG.small" alt="enter image description here"/&gt;
这是某个<a href="http://learningenglish.voanews.com/archive/as-it-is/latest/3521/3521.html"&gt;主题下面最新节目列表页面</a&gt;部分截图：<img src="/download/01YZBHQIYVzw" alt="enter image description here"/&gt;
这是<a href="http://learningenglish.voanews.com/content/un-wpf-syria-heart-swimming/1705955.html"&gt;PDF下载链接与Mp3在线收听页面</a&gt;部分截图：<img src="/download/01YZBHRMAgB8" alt="enter image description here"/&gt;</p&gt;

<h2&gt;下载内容时显示进度条</h2&gt;

<p&gt;知道当前的进度总是一件减少焦虑感的事情。找到需要的下载链接后，使用Python的<code&gt;urllib.urlretrieve()</code&gt;这个方法来下载文件。<code&gt;urllib.urlretrieve()</code&gt;的语法如下：</p&gt;

<pre&gt;<code&gt;urlretrieve(url, filename=None, reporthook=None, data=None)
</code&gt;</pre&gt;

<p&gt;其中，reporthook是接收一定数据后要调用的函数，可以利用此回调函数来实现进度条的功能，reporthook函数的定义如下：</p&gt;

<pre&gt;<code&gt;reporthook(blocknum, blocksize, totalsize)
</code&gt;</pre&gt;

<p&gt;其中，blocknum是接收到的数据包个数，blocksize是数据包的字节数，totalsize是总的需要下载的字节数。对传入的参数进行简单处理就可以得到当前的下载进度。如果直接用print语句输出结果的话，每次调用此函数都会产生新的一行，这显然不是进度条的行为，我们希望在同一行更新进度。首先使用<code&gt;sys.stdout.write()</code&gt;代替print语句可以去掉print自动输出的换行符。然后，在每次输出内容时，先输出回车符（&#39;\b&#39;）让光标回到行首，这样就可以在当前行输出内容，实现进度条的行为。reporthook函数的代码如下：</p&gt;

<pre&gt;<code&gt;# show download progress
# 此函数感谢 http://ljdam.iteye.com/blog/1415336 的分享
def reporthook(blocks_read,block_size,total_size):  
    if not blocks_read:  
        print (&quot;Connection opened&quot;)  
    if total_size &lt;0:  
        sys.stdout.write(&quot;\rRead %d blocks   &quot;  % blocks_read)
        sys.stdout.flush()
    else:  
        sys.stdout.write(&quot;\rdownloading: %d KB, totalsize: %d KB   &quot; % (blocks_read*block_size/1024.0,total_size/1024.0))
        sys.stdout.flush()
</code&gt;</pre&gt;

<h2&gt;保证文件能够完全下载，避免重复下载</h2&gt;

<p&gt;首先避免重复下载，当本地已存在待下载文件时，先从服务器上获取待下载的字节数，与本地文件对比，如果大小相等，那么认为已经正常下载，跳过此文件。这里存在一个问题，有的服务器在hearder中不包含<code&gt;Content-Length</code&gt;这个字段，这时无法判断是否已完全下载。考虑到这种情况很少，且重复下载代价较高，所以也不下载此文件。</p&gt;

<pre&gt;<code&gt;if os.path.isfile(file_path):
    # check length
    length_s = urllib.urlopen( url ).info().get(&#39;Content-Length&#39;, 0)
    length_l = os.path.getsize( file_path )
    if length_s == 0 or long(length_s) == length_l:
        return True
</code&gt;</pre&gt;

<p&gt;然后避免出现未下载完成的文件。在下载时，当关闭程序窗口、手动停止(Ctrl+C)、出现错误时，会在文件系统中残留未下载完成的文件，考虑到这种文件会影响收听，所以应当避免出现未下载完成的文件。处理的思路是，如果在下载过程中遇到任何异常，那么首先删除未完成的邮件，然后将异常冒泡进行后续处理。</p&gt;

<pre&gt;<code&gt;try:
    urllib.urlretrieve(url, file_path, reporthook)
except:
    os.remove( file_path)
    raise
else:
    return True
</code&gt;</pre&gt;

<h2&gt;使用Socks代理来解决GFW的问题</h2&gt;

<p&gt;首先感谢<a href="http://blog.csdn.net/mscf/article/details/7552297"&gt;这个博客</a&gt;的分享。Python可以通过SocksiPy模块来使用Socks代理。SocksiPy的下载与安装见<a href="http://socksipy.sourceforge.net/"&gt;官网</a&gt;。这部分的代码如下：</p&gt;

<pre&gt;<code&gt;import socks
socks.setdefaultproxy(socks.PROXY_TYPE_SOCKS5, &#39;127.0.0.1&#39;, 9050, rdns=False)
socket.socket = socks.socksocket
</code&gt;</pre&gt;

<p&gt;这里首先设置了socks的代理信息，<code&gt;socks.PROXY_TYPE_SOCKS5</code&gt;表示类型为socks5，<code&gt;127.0.0.1</code&gt;与<code&gt;9050</code&gt;分别是代理的IP与端口。我这里使用的是本机作为代理。然后用具有代理功能的套接字覆盖系统缺省的套接字，后续连接就全部走代理了，非常方便。</p&gt;

<p&gt;完整代码请访问这个<a href="https://gist.github.com/yinchuan/6069808"&gt;gist</a&gt;。最后是程序运行截图：<img src="/download/01YZBHKEh9Zn" alt="enter image description here"/&gt;</p&gt;
                </div&gt;

                <div class="copyright-announce"&gt;
                             本文仅用于学习和交流目的，不代表图灵社区观点。非商业转载请注明作译者、出处，并保留本文的原始链接。
                </div&gt;
                <div class="post-taglist"&gt;

                         <a class="post-tag" href="/article/tagged/11" tagid="11"&gt;python</a&gt;
                                                            <!-- JiaThis Button BEGIN --&gt;
                        <div id="ckepop"&gt;
                            

                            <a class="jiathis_cwb" target="_blank" href="/article/share/50268"&gt;分享长微博</a&gt;
                            
                            <span class="jiathis_txt"&gt;</span&gt;<a class="jiathis_button_tsina"&gt;</a&gt;<a class="jiathis_button_douban"&gt;</a&gt;<a class="jiathis_button_tqq"&gt;</a&gt;<a class="jiathis_button_linkedin"&gt;</a&gt;<a href="http://www.jiathis.com/share?uid=891559" target="_blank" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis"&gt;</a&gt;<a class="jiathis_counter_style"&gt;</a&gt;
                        </div&gt;
                    <!-- JiaThis Button END --&gt;
                </div&gt;
            </div&gt;
        </div&gt;

        <div class="row"&gt;
            <div class="span9"&gt;
                <div class="well"&gt;

                    <div class="btn-admins pull-right"&gt;





                    </div&gt;
                    <div class="user-info clearfix"&gt;
                         <a href="/users/99133"&gt;
                             <img class="avatar show-user-card" userid="99133"  src="/Users/GetAvatar/99133?size=Middle" /&gt;yinchuan
                         </a&gt; <br /&gt;
                         <span class="status-date"&gt;发表于 07-24 19:42
                         </span&gt;
                    </div&gt;
                </div&gt;
            </div&gt;
        </div&gt;
        
            <div id="wumii"&gt;
                <script type="text/javascript" id="wumiiRelatedItems"&gt;</script&gt;
            </div&gt;
<script type="text/javascript"&gt;
    var wumiiPermaLink = "http://www.ituring.com.cn/article/50268"; //请用代码生成文章永久的链接
    var wumiiTitle = "从VOA慢速英语的网站上下载Mp3与PDF文本的Python脚本"; //请用代码生成文章标题
    var wumiiTags = "python"; //请用代码生成文章标签，以英文逗号分隔，如："标签1,标签2"
    var wumiiSitePrefix = "http://www.ituring.com.cn/";
    var wumiiParams = "&num=6&mode=2&pf=JAVASCRIPT";
</script&gt;
<script type="text/javascript" src="http://widget.wumii.com/ext/relatedItemsWidget"&gt;</script&gt;
            <a name="firstcomment"&gt;</a&gt;
            <div id="CommentList"&gt;
                
    <div class="subheader"&gt;
        <h1&gt;
            评论</h1&gt;
        <div id="tabs"&gt;
            <a class="" data-ajax="true" data-ajax-mode="replace" data-ajax-update="#CommentList" href="/articlecomment/index/50268?sort=newest"&gt;时间</a&gt;
            <a class="youarehere" data-ajax="true" data-ajax-mode="replace" data-ajax-update="#CommentList" href="/articlecomment/index/50268?sort=vote"&gt;推荐</a&gt;
        </div&gt;
    </div&gt;



    <div class="row reply-item" id="comment-17214"&gt;
    <div             class="firstcomment"
&gt;
        <div class="span1 votecell"&gt;
            <div id="votediv17214" class="vote"&gt;
    
<a data-ajax="true" data-ajax-begin="$(&#39;#vote-17214&#39;).html(&#39;取消推荐&#39;)" data-ajax-mode="replace" data-ajax-update="#votediv17214" href="/ArticleComment/vote/17214" id="vote-17214"&gt;推荐</a&gt;
    <strong&gt;0</strong&gt;

</div&gt;



        </div&gt;
        <div class="span8 postcell"&gt;
            <div class="post-text"&gt;
            IOError: [Errno 22] invalid mode (&#39;wb&#39;) or filename: &#39;D:\\VOA\\Caffeine-is-the-&quot;Drug&quot;-of-Choice-in-Many-Cultures.pdf&#39;<br/&gt;<br/&gt;这个文件似乎一直下不了？是不是这个双引号导致的？
            </div&gt;
            <div class="user-info clearfix pull-right user-comment"&gt;
                <img class="avatar show-user-card" userid="115929" src="/Users/GetAvatar/115929?size=Small" width="32" height="32" /&gt;<a class="show-user-card" href="/users/115929" userid="115929"&gt;tntnt</a&gt;<br /&gt;
                <span class="status-date"&gt; 07-26 14:21 </span&gt;
            </div&gt;

            <div class="replies" id="replies-17214"&gt;
        <div id="reply-21838"&gt;
        <div class="reply"
          &gt;
            <span class="comment-copy"&gt;是的。当时只做了功能，没有过滤title中的一些特殊字符，我马上处理一下。多谢反馈。</span&gt; –&nbsp;
            <a class="show-user-card" userid="99133"  href="/users/info/99133" class="reply-user"&gt;yinchuan</a&gt;
            <span class="status-date"&gt;07-26 15:36</span&gt;
        </div&gt;
        </div&gt;        <div id="reply-21840"&gt;
        <div class="reply"
          &gt;
            <span class="comment-copy"&gt;已修改。使用正则取出title中的单词，实现过滤特殊字符的目的。不过这样一来，文件名会改变，之前下载的文件有点会重复下载，抱歉啦。 &#39;-&#39;.join( re.findall(&#39;(\w+)&#39;, article_title[0]) )</span&gt; –&nbsp;
            <a class="show-user-card" userid="99133"  href="/users/info/99133" class="reply-user"&gt;yinchuan</a&gt;
            <span class="status-date"&gt;07-26 15:45</span&gt;
        </div&gt;
        </div&gt;        <div id="reply-21866"&gt;
        <div class="reply"
          &gt;
            <span class="comment-copy"&gt;多谢 @yinchuan</span&gt; –&nbsp;
            <a class="show-user-card" userid="115929"  href="/users/info/115929" class="reply-user"&gt;tntnt</a&gt;
            <span class="status-date"&gt;07-29 12:26</span&gt;
        </div&gt;
        </div&gt;            </div&gt;
            <div class="btn-replies"&gt;
            </div&gt;
        </div&gt;
    </div&gt;
    </div&gt;
    <hr /&gt;
    <div class="row reply-item" id="comment-17189"&gt;
    <div &gt;
        <div class="span1 votecell"&gt;
            <div id="votediv17189" class="vote"&gt;
    
<a data-ajax="true" data-ajax-begin="$(&#39;#vote-17189&#39;).html(&#39;取消推荐&#39;)" data-ajax-mode="replace" data-ajax-update="#votediv17189" href="/ArticleComment/vote/17189" id="vote-17189"&gt;推荐</a&gt;
    <strong&gt;0</strong&gt;

</div&gt;



        </div&gt;
        <div class="span8 postcell"&gt;
            <div class="post-text"&gt;
            源码可分享不？跑你博客，只看到 about me  :-)
            </div&gt;
            <div class="user-info clearfix pull-right user-comment"&gt;
                <img class="avatar show-user-card" userid="92165" src="/Users/GetAvatar/92165?size=Small" width="32" height="32" /&gt;<a class="show-user-card" href="/users/92165" userid="92165"&gt;易枭寒</a&gt;<br /&gt;
                <span class="status-date"&gt; 07-25 13:25 </span&gt;
            </div&gt;

            <div class="replies" id="replies-17189"&gt;
        <div id="reply-21826"&gt;
        <div class="reply"
          &gt;
            <span class="comment-copy"&gt;源码在github上，https://gist.github.com/yinchuan/6069808  
这个脚本需要在本机上有一个socks5代理，我是用 MyEnTunnel生成的，如果会科学上网的话，肯定懂的。  
我现在主要在图灵上写文章，博客没用上。那个 about me页面是之前用来放简历的，sorry 误导你了。  
</span&gt; –&nbsp;
            <a class="show-user-card" userid="99133"  href="/users/info/99133" class="reply-user"&gt;yinchuan</a&gt;
            <span class="status-date"&gt;07-25 14:21</span&gt;
        </div&gt;
        </div&gt;            </div&gt;
            <div class="btn-replies"&gt;
            </div&gt;
        </div&gt;
    </div&gt;
    </div&gt;
    <hr /&gt;


        <h3&gt;我要评论</h3&gt;

    <div id="CommentForm"&gt;
            <div id="logon-div"&gt;
    


<form action="/account/_logon/50268?Length=7" class="well form-inline" data-ajax="true" data-ajax-failure="onLogonFail" data-ajax-success="onLogonSuccess" id="form0" method="post"&gt;<legend&gt;需要登录后才能发言</legend&gt;
<input data-val="true" data-val-required="请填写用户名" id="UserName" name="UserName" type="text" value="" /&gt;     
<input data-val="true" data-val-required="请填写密码" id="Password" name="Password" type="password" /&gt;     
<input data-val="true" data-val-required="The 记住我 field is required." id="RememberMe" name="RememberMe" type="checkbox" value="true" /&gt;<input name="RememberMe" type="hidden" value="false" /&gt;     
<label for="RememberMe"&gt;记住我</label&gt;     
    <input type="submit" value=" 登录 " class="btn btn-primary" /&gt;
</form&gt;
<div class="validation-summary-valid" data-valmsg-summary="true"&gt;<span&gt;登录未成功，请修改提交。</span&gt;
<ul&gt;<li style="display:none"&gt;</li&gt;
</ul&gt;</div&gt;


        <script type="text/javascript"&gt;

            function onLogonSuccess() {
                 $.get("/articlecomment/add/50268?isErrata=False", function (data) {
                    $("#CommentForm").html(data);
                    $.get("/account/_logonpartial", function(logdata) {
                        $("#logindisplay").html(logdata);
                    });
                });
            }

            function onLogonFail(jqXHR) {
                $("#logon-div").html(jqXHR.responseText);
            }  

        </script&gt;


    </div&gt;

    </div&gt;



<div id="reply-form" class="hide"&gt;

<form action="/reply/add" data-ajax="true" data-ajax-begin="window.disableCalmer" data-ajax-failure="onReplyFailure" data-ajax-mode="after" data-ajax-success="onReplySuccess" data-ajax-update="#placeholder" id="form1" method="post"&gt;        <input type="hidden" name="" /&gt;
        <textarea name="body" style="width: 95%"&gt;
        </textarea&gt;
        <br /&gt;
<input type="submit" value=" 提交 " class="btn btn-primary calmer" /&gt; <input type="button" id="cancel" value=" 取消 " class="btn" /&gt; <span id="reply-error" style="color: #c33"&gt;</span&gt;
</form&gt;
</div&gt;

<script type="text/javascript"&gt;

    function onReplySuccess() {
        $(".add-reply").parent().show();
        $("#reply-form").hide();
        window.enableCalmer();
    }

    function onReplyFailure(jqXHR) {
        $("#reply-error").text(jqXHR.responseText);
        window.enableCalmer();
    }


    $(function () {

        $("#cancel").click(function () {
            $("#reply-form").hide();
            $(".add-reply").parent().show();
        });

        $(".add-reply").click(function () {
            var replyForm = $("#reply-form");
            replyForm.find("form").attr("data-ajax-update", "#replies-" + $(this).attr("target-id"))
            replyForm.find("input[type=hidden]").attr("name", $(this).attr("target-name"));
            replyForm.find("input[type=hidden]").val($(this).attr("target-id"));
            replyForm.find("textarea").val("");

            replyForm.show().appendTo($("#reply-form-" + $(this).attr("target-id")));
            $("#reply-error").text("");

            $(this).parent().hide();
            return false;
        });

    });
</script&gt;

            </div&gt;

    </div&gt;
    <div class="span3 side-right"&gt;

        <div class="module"&gt;
<form action="/Article" method="post"&gt;            <div class="input-append"&gt;
            <input class="span2" id="keyword" name="keyword" type="text" value="" /&gt;<input type="submit" class="btn" value="搜索" /&gt;
            </div&gt;
</form&gt;        </div&gt;



                         

                         


    <div id="related-tags" class="module"&gt;
        <h4 id="h-related-tags"&gt;
            本文标签</h4&gt;

             <a class="post-tag" href="/article/tagged/11" tagid="11"&gt;python</a&gt;
            <span class="item-multiplier"&gt;×&nbsp;810</span&gt;
            <br/&gt;

    </div&gt;





    <div class="module"&gt;
        <h4 id="h-related-tags"&gt;
            推荐会员</h4&gt;
            <a href="/users/82554" &gt;
                <img class="side-avatar show-user-card" userid="82554" class="side-avatar" src="/Users/GetAvatar/82554?size=Small" width="32" height="32" /&gt;
            </a&gt;
        <div style="clear:both"&gt;</div&gt;
    </div&gt;

    <div class="module"&gt;
        <h4 id="h-related-tags"&gt;
            相关标签</h4&gt;


             <a class="post-tag" href="/article/tagged/2" tagid="2"&gt;web编程与设计</a&gt;
            <span class="item-multiplier"&gt;×&nbsp;4</span&gt;
            <br/&gt;

    </div&gt;



    </div&gt;
</div&gt;

		</div&gt;
		
	</div&gt;
	<div id="footer"&gt;
	  <div class="container"&gt;
		<ul id="footmenu"&gt;
			<li class="first"&gt;<a href="/users/guaguacode"&gt;刮刮卡</a&gt;</li&gt;
			<li&gt;<a href="/article/36242"&gt;联系我们</a&gt;</li&gt;
			<li&gt;<a href="/article/7751"&gt;常见问题</a&gt;</li&gt;
			<li&gt;<a href="/article/17095"&gt;建议改进</a&gt;</li&gt;
		</ul&gt;
		<p&gt;
		  2005-2013 &copy; 北京图灵文化发展有限公司 · All Rights Reserved
		</p&gt;
		<p class="muted"&gt;
		  京ICP备11039595号
		</p&gt;

	  </div&gt;
	</div&gt;
<div id="toTop"&gt;
<a href="#"&gt;▲</a&gt;
<a href="#footer"&gt;▼</a&gt;
</div&gt;
		<div id="popup"&gt;<div class="user-card" id="tagcard"&gt;</div&gt;<p class="corner"&gt;</p&gt;</div&gt;



<div class="modal fade hide" id="wModal"&gt;
  <div class="modal-header"&gt;
	<button type="button" class="close" data-dismiss="modal"&gt;×</button&gt;
	<h4&gt;modalMsg</h4&gt;
  </div&gt;
  <form action="" data-ajax="true" data-ajax-failure="modalMsgError" data-ajax-success="modalMsgSuccess" data-ajax-begin="window.disableCalmer" id="formModalMsg" method="post"&gt;
  <div class="modal-body"&gt;
	<textarea cols="20" id="msgBody" name="Body" rows="2" style="width:97%;height:80px;"&gt;</textarea&gt;
	<input id="ReceiverUserName" name="ReceiverUserName" type="hidden" value=""&gt;
	<span id="error-span" style="color:red"&gt;</span&gt;
	<span id="success-span" style="color:#080"&gt;</span&gt;
  </div&gt;
  <div class="modal-footer"&gt;
	<input type="button" class="btn" data-dismiss="modal" value="取消"&gt;
	<input type="submit" id="submitMsg" class="btn btn-message calmer" value=" 发 送 "&gt;
  </div&gt;
  </form&gt;
</div&gt;
		</body&gt;



</html&gt;
        </textarea>
        </div>
        <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
        <script src="../js/clearly.js"></script>
        <script>
            var html = window.__getMyClearlyResults().html;
            $('#main_content_wrap').html(html);
        </script>
  </body>
</html>
