
<!DOCTYPE html>
<html lang="en" class="isUnknown ver00 isAnonymous " prefix="og: http://ogp.me/ns#" >
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Five Patterns to Help You Tame Asynchronous JavaScript - Tech.Pro</title>
        <link rel="shortcut icon" href="//tpstatic.com/img/root/techpro/favicon.ico">
        <link rel="apple-touch-icon" sizes="57x57" href="//tpstatic.com/img/root/techpro/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="//tpstatic.com/img/root/techpro/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="//tpstatic.com/img/root/techpro/apple-touch-icon-144x144.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="//tpstatic.com/img/root/techpro/apple-touch-icon-144x144.png" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="search" type="application/opensearchdescription+xml" title="Tech.Pro" href="/OpenSearch">
        <script type="text/javascript" src="//use.typekit.net/wsf0avv.js"></script>
        <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
        <link href="//tpstatic.com/bundles/css/bootstrap?v=pfT5OW9kXDWaj6LD9DsIHJM2wLvIExsAA_6Kl1jBrCg1" rel="stylesheet"/>

        <link href="//tpstatic.com/bundles/css/master?v=EgUAFTmzP56l7SCKeudMfPQ7QTCNXkn8WM9N3ctHSNg1" rel="stylesheet"/>

        
        
    <link href="http://tech.pro/blog/1402/five-patterns-to-help-you-tame-asynchronous-javascript" rel="canonical" />
    <meta name="twitter:card" value="summary" />
    <meta name="twitter:site" value="@techdotpro" />
    <meta name="twitter:creator" value="ifandelse" />

    <meta content="article" property="og:type" />
<meta content="Five Patterns to Help You Tame Asynchronous JavaScript" property="og:title" />
<meta content="http://tech.pro/blog/1402/five-patterns-to-help-you-tame-asynchronous-javascript" property="og:url" />
<meta content="//tpstatic.com/img/usermedia/zSvgVinS40ykaVRODOoqzg/original.png" property="og:image" />
<meta content="248957485211620" property="og:app_id" />
<meta content="Tech.Pro" property="og:site_name" />

    <meta content="Jim Cowart" property="og:article:author" />
    <meta content="Blog" property="og:article:section" />
<meta content="07/01/2013 22:07:34" property="og:article:published_time" />
    <meta content="Tech.Pro" property="og:site_name" />
    <meta content="You can hardly write ten lines of JavaScript before you&#39;re confronted with asynchronous behavior. In this post we&#39;re going to look at 5 patterns that can help..." property="og:description" />
    <meta content="You can hardly write ten lines of JavaScript before you&#39;re confronted with asynchronous behavior. In this post we&#39;re going to look at 5 patterns that can help..." name="description" />
<link href="https://plus.google.com/111043802019079447961/posts" rel="author" />
    
<meta content="JavaScript" property="og:article:tag" /><meta content="Async" property="og:article:tag" /><meta content="Events" property="og:article:tag" /><meta content="Promises" property="og:article:tag" /><meta content="Patterns" property="og:article:tag" />    <meta content="(Tag#744) - JavaScript,(Tag#1350) - Async,(Tag#1180) - Events,(Tag#1482) - Promises,(Tag#1483) - Patterns" name="keywords" />
    <link href="//tpstatic.com/bundles/css/articles?v=omdQR4zhVx9AN5afLMkhXxVSJ1gjfLbZEeC8sRrTStk1" rel="stylesheet"/>


        <script type="text/javascript">window.tprq=[];TP = { ready: function (f) { tprq.push(f); } };</script>
        <!--[if lt IE 9]>
        <script src="//tpstatic.com/scripts/ext/html5shiv.js"></script>
        <![endif]-->
        
    </head>
    <body>
        
        

        <div id="tp-alerts">
            
        </div>
        
        <div class="bg-container">
            <span id="mobile_menu_link">Menu</span>
            <div class="container">

                <div id="navbar" class="navbar">
                    <div id="top-nav">
    <span itemscope="" itemtype="http://schema.org/Organization" >
        <a class="logo" href="/" itemprop="url">Tech.Pro</a>
        <meta itemprop="img" content="http://tech.pro/apple-touch-icon-144x144.png"/>
    </span>
    <ul id="nav-tools" class="navigation pull-right">
        <li>
            <a id="createProfile" href="/register?returnUrl=%2Fblog%2F1402%2Ffive-patterns-to-help-you-tame-asynchronous-javascript&amp;returnTitle=Five%20Patterns%20to%20Help%20You%20Tame%20Asynchronous%20JavaScript" rel="nofollow">Create a Profile</a>
            <span class="muted" style="margin: 0 6px;display: inline-block;">or</span>
            <a class="-login" href="/login?returnUrl=%2Fblog%2F1402%2Ffive-patterns-to-help-you-tame-asynchronous-javascript" rel="nofollow">Login</a>
        </li>
    </ul>
    <ul id="tp-main-nav" class="navigation">
        <li class="dropdown active">
            <a href="http://tech.pro/">Content</a>
            <ul class="dropdown-menu">
                <li><a href="/">Feed</a></li>
                <li><a href="/tutorials">Tutorials</a></li>
                <li><a href="/blogs">Blogs</a></li>
                <li><a href="/links">Links</a></li>
                <li><a href="/questions">Q&amp;A</a></li>
            </ul>
            <div class="indicator"></div>
        </li>
        <li class="dropdown ">
            <a href="http://tech.pro/profiles">Network</a>
            <ul class="dropdown-menu">
                <li><a href="/profiles">Profiles</a></li>
                <li><a href="/authors">Authors</a></li>
                <li><a href="/projects">Projects</a></li>
                <li><a href="/network">My Network</a></li>
            </ul>
            <div class="indicator"></div>
        </li>
        
        <li class="dropdown ">
            <a href="http://tech.pro/about-us">More</a>
            <ul class="dropdown-menu">
                <li><a href="/how-it-works">How Tech.Pro Works</a></li>
                <li><a href="/about-us">About Us</a></li>
                <li><a href="/contact-us">Contact Us</a></li>
                <li><a href="/sitemap">Site Map</a></li>
            </ul>
            <div class="indicator"></div>
        </li>
            <li class="mobile-nav"><a href="/login?returnUrl=%2Fblog%2F1402%2Ffive-patterns-to-help-you-tame-asynchronous-javascript">Login</a></li>
            <li class="mobile-nav"><a href="/register?returnUrl=%2Fblog%2F1402%2Ffive-patterns-to-help-you-tame-asynchronous-javascript">Create a Profile</a></li>
    </ul>
</div>
<div id="sub-nav">
    
    <!-- ko stopBinding: true -->
    <form class="-global-search" id="global-search-form" data-bind="submit: search">
        <div id="global-search" class="dropdown">
                            
            <input class="search-input -tooltip no-jq-placeholder" placeholder="Search Tech.Pro" title="Search Tech.Pro" type="text" data-bind="value: searchValue, hasfocus: hasfocus" />
            <a class="dropdown-toggle" data-toggle="dropdown" href="#"><b class="caret"></b></a>
            <span class="global-search-button" data-bind=""></span>
            <ul class="search-options dropdown-menu pull-right" data-bind="foreach: searchOptions">
                <li>
                    <label class="radio">
                        <input type="radio" name="globalsearchRadio" data-bind="value: value, checked: $parent.selectedOption" />&nbsp;
                        <span data-bind="text: title"></span>
                    </label>
                </li>
            </ul>
        </div>
    </form>
    <!-- /ko -->
    
    <ul class="action-bar horizontal-list">
        <li class="first">SHARE:</li>
            <li class="actions-item -tooltip" title="Post a Tutorial" data-tp="tutorial">
                <i class="tp-post-type smallmedium tutorial">&nbsp;</i>
            </li>
            <li class="actions-item -tooltip" title="Post a Blog" data-tp="blog">
                <i class="tp-post-type smallmedium blog">&nbsp;</i>
            </li>
            <li class="actions-item -tooltip" title="Share a Link" data-tp="link">
                <i class="tp-post-type smallmedium link">&nbsp;</i>
            </li>
            <li class="actions-item -tooltip" title="Ask a Question" data-tp="question">
                <i class="tp-post-type smallmedium question">&nbsp;</i>
            </li>
    </ul>
    
        <ul class="navigation">
                <li><a class="" href="/">Feed</a></li>
                <li><a class="" href="/tutorials">Tutorials</a></li>
                <li><a class="" href="/blogs">Blogs</a></li>
                <li><a class="" href="/links">Links</a></li>
                <li><a class="" href="/questions">Q&amp;A</a></li>
        </ul>

</div>

                </div>
                




<table class="tp-signup-banner" border="0" cellpadding="0" cellspacing="0">
    <tr>
<td class="signup-logo"><img src="//tpstatic.com/img/layout/techpro/joinBannerImage.png" /></td>        <td class="tagline"><span class="tagline-text">The nerd table is now the cool table.</span></td>
        <td class="signup-action">
            <a id="signupbannerjoinnow" class="btn btn-yellow" href="/how-it-works">
                learn more
            </a>
        </td>
    </tr>
</table>
<script>
    TP.ready(function () {
        $("#signupBannerJoinNow").click(function() {
            TP.trackEvent({ category: "join_now_click", action: "The nerd table is now the cool table." });
        });
    })
</script>



<div id="content-wrapper">

    <div class="sidebar-wrapper clearfix">       
        <div class="pane content-pane main-body clearfix">
            



<div itemscope="" itemtype="http://schema.org/Article"  class="-entity" data-tp="{&quot;id&quot;:1402,&quot;type&quot;:&quot;article&quot;,&quot;score&quot;:21}">


    <div class="clearfix -article-profile">
        <div class="pull-right" style="text-align: right; margin: 0 0 8px 0;">

            <ul class="tp-tag-list" itemprop="keywords">
    <a class="tp-tag" data-tp="{&quot;id&quot;:744}" >
        <span>JavaScript</span>
    </a>
    <a class="tp-tag" data-tp="{&quot;id&quot;:1350}" >
        <span>Async</span>
    </a>
    <a class="tp-tag" data-tp="{&quot;id&quot;:1180}" >
        <span>Events</span>
    </a>
    <a class="tp-tag" data-tp="{&quot;id&quot;:1482}" >
        <span>Promises</span>
    </a>
    <a class="tp-tag" data-tp="{&quot;id&quot;:1483}" >
        <span>Patterns</span>
    </a>
            </ul>

        </div>

            <span class="tp-author-card" itemscope itemprop="author" itemtype="http://schema.org/Person">
            <a href="http://tech.pro/jimcowart" class="tp-gravatar small pull-left" data-tp="{&quot;id&quot;:16747}">
        <img width="24" height="24"  alt="Jim Cowart" src="http://www.gravatar.com/avatar/50f0d186eeb223478981dec5d786233b.png?d=retro&amp;s=24"  itemprop="image"/>
    </a>

        <span>
            <a class="author" href="http://tech.pro/jimcowart" itemprop="url">
                <span itemprop="name">Jim Cowart</span>
            </a>
                <br />
                <span class="post-date">posted <time datetime="2013-07-01T22:07:34" itemprop="datePublished">2 months ago</time></span>
        </span>
    </span>


        <span class="tp-entity-tools">

                            <span title="Flag Article" class="-flag -tooltip"><i class="tp-di-icon">K</i> </span> 
        </span>
    </div>


    <div>
        
        <h1 class="tp-article-title" itemprop="headline">Five Patterns to Help You Tame Asynchronous JavaScript</h1>
    </div>
    <div class="tp-body clean-type center-images clearfix" itemprop="articleBody">
             <img class="tp-article-image" src="//tpstatic.com/img/usermedia/zSvgVinS40ykaVRODOoqzg/cropped-w220-h220.png" itemprop="image"/>   
        
        <!-- ko stopBinding: true --><p>You can hardly write ten lines of JavaScript before you're confronted with asynchronous behavior. In this post we're going to look at 5 patterns that can help you tame the beast - or at least keep it at bay. It would be nearly impossible to cover each pattern in depth in this post alone, but my aim is to provide enough information to get you started, with an additional reading section at the end.</p>

<p>Let me emphasize here that none of these patterns are <em>only</em> asynchronous. In fact, all of them work well in synchronous contexts also. </p>

<h1 id="whats_asynchronous_a_quick_primer">What's 'Asynchronous'? A Quick Primer…</h1>

<p>Your JavaScript code is executed in an event loop, on a single thread. The reality is that <em>all</em> JavaScript executes synchronously - it's the event loop that allows you to queue up an action that won't take place until the loop is available some time <em>after</em> the code that queued the action has finished executing. So code is said to execute asynchronoulsy when it is queued to run sometime after the event loop is available. Or, as Trevor Burnham said in his book <a href="http://pragprog.com/book/tbajs/async-javascript">Async JavaScript</a>:</p>

<blockquote>
  <p>"Events can be queued while code is running, but they can't fire until the runtime is free."</p>
</blockquote>

<p>Enough talk, code is proof:</p>

<pre><code>function maybe() {
    console.log("…execute async, maybe?");
}

function proveIt() {
    setTimeout(maybe, 0);
    console.log("Hey, you just invoked me, and this is crazy…");
    console.log("But I'll queue you up");
    return "and you'll…";
}

proveIt();
</code></pre>

<p>Running this in Chrome's JavaScript console will give you the following:</p>

<p><img src="http://tpstatic.com/img/usermedia/K9z3UePCckizCYzBPYKxJg/original.png" alt="Async Proof" /></p>

<p>We used <code>setTimeout</code> in the above example to queue up the <code>maybe</code> function to execute 0 milliseconds after the event loop is available. The event loop won't be available until it completes its current execution stack - in this case, the rest of the <code>proveIt</code> function which includes two <code>console.log</code> statements &amp; the return. As soon as the <code>proveIt</code> function returns, the runtime is free, and the queued up <code>maybe</code> function can execute. You can actually see where <code>proveIt</code> returns in the above output: where you see the string "and you'll…" printed on the console. You can tell from the console output that at this point, <code>proveIt</code> has completed, and our queued <code>maybe</code> function's output appears after that.</p>

<blockquote>
  <p>Just in case <code>setTimeout</code> is new to you (or you are new to JavaScript), two async 'primitives' exist across all major runtimes:</p>
  
  <ul>
  <li><code>setTimeout(fn, x)</code> (which queues a function <code>f</code> to be invoked after <code>x</code> milliseconds, though the actual delay could be longer)</li>
  <li><code>setInterval(fn, x)</code> (which allows repeated invocations of function <code>fn</code> with a delay of <code>x</code> between each - though the delay could be longer).</li>
  </ul>
  
  <p>For more information, check out the MDN articles on <a href="https://developer.mozilla.org/en-US/docs/Web/API/window.setTimeout">setTimeout</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/window.setInterval">setInterval</a>. Some environments provide additional async primitives: node.js has <a href="http://nodejs.org/api/process.html#process_process_nexttick_callback"><code>process.nextTick</code></a> and many browsers support <a href="https://developer.mozilla.org/en-US/docs/Web/API/window.requestAnimationFrame"><code>requestAnimationFrame</code></a> - which also provides a means to queue a callback to be invoked before a repaint.</p>
</blockquote>

<p>Even our contrived example above shows you that the JavaScript code you write will need to handle the reality of asynchronicity. Whether it's waiting for an AJAX response, a button click, a mouseover or any number of other possibilities, there's no escape. No need to worry - we have the tools to meet the challenge. The first one we'll cover is the foundation upon which all the others stand.</p>

<h1 id="callbacks">1.) Callbacks</h1>

<p>Callbacks are the currency…the fundamental building block…the <em>lynchpin</em> of asynchronicity in JavaScript. No matter where you go from here, the higher-level abstractions are just intelligent wrappers (for good reason, btw) around plain, vanilla callbacks. If you're new to JavaScript – and depending on what language you hail from – seeing functions passed as arguments might be a bit unfamiliar, but don't fret, it's easy and fun:</p>

<pre><code>// plain, non-jQuery version of hooking up an event handler
var clickity = document.getElementById("clickity");
clickity.addEventListener("click", function (e) {
    //console log, since it's like ALL real world scenarios, amirite?
    console.log("Alas, someone is pressing my buttons…");
});

// the obligatory jQuery version
$("#clickity").on("click", function (e) {
    console.log("Alas, someone is pressing my buttons…");
});
</code></pre>

<p>Even if you're new to JavaScript, if you've spent <em>any</em> amount of time in the web, you've probably written something similar to the above code. Both <code>addEventListener</code> and <code>on</code> take a callback argument - the second argument being passed. This function will be invoked when the <code>click</code> event occurs. At the moment, we're just taking advantage of the fact our DOM element (presumably a button) has the underlying functionality to store the callback we pass to it and invoke it later when the event occurs (btw - this is an implementation of the <a href="http://en.wikipedia.org/wiki/Observer_pattern">Observer Pattern</a>, more on that later when we talk about Events). However, it's very easy to write your own objects to be capable of invoking callbacks:</p>

<pre><code>var worker = {
    updateCustomer: function (customerInfo, cb) {
        $.ajax({
            url: "/some/api",
            type: "POST",
            data: customerInfo
        }).done(function (data) {
            // let's pretend there's some DOM to update…
            $("#update-status").removeClass("editing").addClass("saved");
            cb(null, data);
        }).fail(function (data) {
            // let's pretend there's some DOM to update…
            $("#update-status").removeClass("editing").addClass("failed");
            cb(data);
        });
    }
    // other methods, properties, etc
};

// and somewhere else, the calling code:
// (assuming we already have a currentCustomer instance, etc)
worker.updateCustomer(currentCustomer, function (err, data) {
    alert(err || data); // *sigh*, who really uses alerts these days?!
});
</code></pre>

<blockquote>
  <p>There are some problems with the above <code>worker</code> instance (it's tightly coupling AJAX &amp; DOM updates, for one), but we'll overlook those <em>for now</em>.</p>
</blockquote>

<p>Since functions in JavaScript are <a href="http://en.wikipedia.org/wiki/First-class_function">first class citizens</a>, we are able to pass them as arguments to other functions. In our example above, the <code>updateCustomer</code> method takes two arguments, the second of which – <code>cb</code> – is a callback function that is to be invoked once <code>updateCustomer</code> has completed executing. This is the essence of passing callbacks, and writing methods that take callback arguments - it doesn't get much lower-level than this. This is often referred to as "<a href="http://en.wikipedia.org/wiki/Continuation-passing_style">continuation passing style</a>" (CPS). The callback is the "continuation", and the invoked function passes control to it as it invokes it, passing in the result(s).</p>

<p>I should mention that you will often run into situations where you want to specify the "context" of your callback function (i.e. - what <code>this</code> will be inside the function when invoked by the method to which you are passing it). You will need to bind your function (in most cases) prior to passing it as an argument. For example:</p>

<pre><code>// assuming we have a notifier instance, with a "showAlert" method on it...

// ES5 bind function (or using a shim)
worker.updateCustomer(currentCustomer, function(err, data) {
    this.showAlert(err || data);
}.bind(notifier));

// using underscore/lodash
worker.updateCustomer(currentCustomer, _.bind(function(err, data) {
    this.showAlert(err || data);
}, notifier));


// using jquery
worker.updateCustomer(currentCustomer, $.proxy(function(err, data) {
    this.showAlert(err || data);
}, notifier));
</code></pre>

<p>In the examples above, we've bound the "this" context of our callback to be the <code>notifier</code> instance, so that <code>this.showAlert</code> inside our callback function will be the same as if the worker had access to call <code>notifier.showAlert</code>. But why is this useful?</p>

<p>The method we pass our callback into may belong to an instance that has no knowledge of (nor even a reference to) the object calling it - this is a good thing! It's called separation of concerns &amp; encapsulation. However, if we're passing a callback that's actually a <em>method</em> on the calling object, we have to bind the context, or we're going to have a bad experience. Let's check a slightly modified example:</p>

<pre><code>var updateForm = {
    submit: function() {
        // get the data and store it in currentCustomer
        worker.updateCustomer(currentCustomer, this.showAlert.bind(this));
    },
    showAlert: function(err, data) {
        // I don't care how, just show an alert :-)
    }
};
</code></pre>

<p>We could spend an entire post on binding and context alone, but we'll stop there. If you're interested in reading more, I recommend checking out "<a href="http://freshbrewedcode.com/jimcowart/2013/02/12/getting-into-context-binds/">Getting Into Context Binds</a>".</p>

<h2 id="callback_conclusion">Callback Conclusion</h2>

<h3 id="pros">Pros</h3>

<ul>
<li><strong>Simplicity</strong> - Callbacks are simple! (The caveat being that you are responsible for maintaining the correct context, if needed.) You pass a function, it gets invoked at some point in the future.</li>
<li><strong>Lightweight</strong> - No extra libs required. Functions-as-first-class-citizens is built into the language. No need for additional code to make it work.</li>
</ul>

<h3 id="cons">Cons</h3>

<ul>
<li><strong>Can Be An Insufficient Abstraction</strong> - Sometimes you need additional 'sugar'. This is where patterns 2-5 will come into play, each build upon the foundation of callbacks in different ways.</li>
<li><strong>Complex When Nested</strong> - Callbacks are difficult to read, debug and maintain when deeply nested. The goto-example these days to describe this problem is "the pyramid of doom". </li>
</ul>

<p>Let's take a look:</p>

<pre><code>var allTheCustomerThings;
$("#getCustomer").click(function (cust) {
    var id = $("#cust-id").val();
    getCustomer(id, function (cust) {
        allTheCustomerThings = cust;
        getContacts(id, function (contacts) {
            allTheCustomerThings.contacts = contacts;
            getOrders(id, function (orders) {
                allTheCustomerThings.orders = orders;
                getAccountsRecv(id, function (ar) {
                    allTheCustomerThings.ar = ar;
                    // OK - we got all the data, NOW WHAT?! :-)
                });
            });
        });
    });
});
</code></pre>

<p>The deeper the nesting, the more you see the pyramid. This is both a <em>real problem</em> and a <em>straw man</em>. It's real problem in that I've seen it happen - but primarily by developers new to JavaScript and/or developers not spending the time to properly plan and architect their application. It's a straw man in that it's often blindly cited as <em>the knee-jerk reason</em> to use promises, without proper attention being paid to good design, even <em>if</em> promises are used to mitigate the nesting. (There are legitimate and compelling reasons to use promises, of course! But I can just as easily slap promises on a terribly written code base only to eliminate nesting.) Low level patterns don't fix higher level design problems - so be sure to think through how you are modeling a problem in code if you end up with deep callback nesting, and consider it both a code <em>and</em> design smell that should prompt you to address the systemic issue(s) with the overall design and not just the nesting strategy.</p>

<h1 id="observer_pattern_a.k.a._events">2.) Observer Pattern (a.k.a. Events)</h1>

<p>One of the cons of plain callbacks – that it can be an insufficient abstraction" – is the perfect segue to where events can be useful. What if we don't want to keep passing a callback each time we invoke the target method? What if we wanted our own callback to be invoked if <em>another piece of calling code</em> also invoked the target method? The <a href="http://en.wikipedia.org/wiki/Observer_pattern">Observer Pattern</a> fits well here.</p>

<p>The what?!</p>

<p>The Observer Pattern isn't hard at all. You have a <em>subject</em> that emits events (often referred to as an "event emitter"), and <em>observers</em>, which register callbacks with the <em>subject</em> to be notified as to when those events occur. In other words, let's assume <a href="http://dougneiner.com/">Doug Neiner</a> and I are playing Halo 4. <a href="http://freshbrewedcode.com/alexrobson/">Alex Robson</a> tells me that he'd like to know when Doug steals one of my kills. In this case, I am the subject and Alex is the observer. Unfortunately, Alex will want to <a href="http://davidwalsh.name/function-debounce">debounce</a> his callback, since he will receive <em>a lot</em> of event notifications.</p>

<p>There are a few key details to bear in mind with the Observer Pattern:</p>

<ul>
<li>Observers must have a direct reference to the subject.</li>
<li>Subjects are responsible for maintaining the internal state of subscriber callbacks</li>
<li>JavaScript implementations of this pattern usually involve subscriber callback method signatures of 0-n arguments (in other words, every event could have a different signature).</li>
</ul>

<p>Let's demonstrate the Observer pattern in code, describing our Halo 4 example (you can view this in a fiddle <a href="http://jsfiddle.net/ifandelse/gstrW/">here</a>):</p>

<pre><code>// This observer object can be mixed into any object, giving it the basic
// API necessary to add and remove subscribers as well as emit events
var observer = {
    // 'subscribers' will keep track of subscribers by event name
    // each event name subscribed to will be a member name on
    // this object, w/ the value as an array of objects containing
    // the subscriber callback and optional function context
    subscribers: {},

    // the 'on' method is used by subscribers to add a callback
    // to be invoked when a specific event is emitted
    on: function (event, cb, context) {
        this.subscribers[event] = this.subscribers[event] || [];
        this.subscribers[event].push({
            callback: cb,
            context: context
        });
    },

    // 'off' allows subscribers to remove their callbacks
    off: function (event, cb, context) {
        var idx, subs, sub;
        if ((subs = this.subscribers[event])) {
            idx = subs.length - 1;
            while (idx &gt;= 0) {
                sub = subs[event][idx];
                if (sub.callback === cb &amp;&amp; (!context || sub.context === context)) {
                    subs[event].splice(idx, 1);
                    break;
                }
                idx--;
            }
        }
    },

    // iterates over the subscriber list for 
    // a given event and invokes the callbacks
    emit: function (event) {
        var subs, idx = 0,
            args = Array.prototype.slice.call(arguments, 1);
        if ((subs = this.subscribers[event])) {
            while (idx &lt; subs.length) {
                sub = subs[idx];
                sub.callback.apply(sub.context || this, args);
                idx++;
            }
        }
    }
};
// 