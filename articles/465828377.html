<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Introducing Event-Focused JS and CSS (EFJAC) — Objects in Space — Medium</title>
<link rel="stylesheet" href="../css/article.css" />
</head>
<body>
<div class="m-content">
<h1>Introducing Event-Focused JS and CSS (EFJAC) — Objects in Space — Medium</h1>
<div><h3 name="7a0e">The Summary</h3><p name="f55e">Use CSS for anything visual. Bind event listeners to elements with a <em>data-behavior</em> attribute and fire your own custom events when things happen. Listen for those custom events and add/remove CSS classes to make visual changes. Got it?</p><figure name="829d"><img data-width="981" data-height="448" width="700" height="320" data-action="zoom" data-action-value="0*F7QGloSoYrmYcxB8.jpeg" data-id="755967638465" src="https://d233eq3e3p3cv0.cloudfront.net/max/800/0*F7QGloSoYrmYcxB8.jpeg" /></figure><h2 name="0592">The Code</h2><p name="6d5a">I’ll be building something very similar to my task screen above, albeit a simplified version. First, some HTML:</p><pre name="c47b">&lt;ul id="tasks"&gt;<br />&lt;li class="task"&gt;<br />&lt;h2&gt;Task name&lt;/h2&gt;<br />&lt;p&gt;Task description&lt;/h2&gt;<br />&lt;a href="#" class="open-task"&gt;Open&lt;/a&gt;<br />&lt;form action="/echo/json&gt;<br />&lt;input type="text" name="name"&gt;<br />&lt;a href="#" class="save"&gt;Save&lt;/a&gt;<br />&lt;/form&gt;<br />&lt;/li&gt;<br />&lt;/ul&gt;</pre><p name="0cf7">The form submits to a test endpoint that always returns successfully. This is just enough code to get us going. Let’s make it somewhat pretty:</p><pre name="356e">body {<br />background-color: #eeeeee;<br />}</pre><pre name="ff47">ul {<br />margin: 0;<br />padding: 0;<br />list-style: none;<br />}</pre><pre name="a4e3">.task {<br />overflow: auto;<br />background-color: #ffffff;<br />padding: 10px;<br />}</pre><pre name="4e38">h2 {<br />margin: 0;<br />font-size: 16px;<br />font-weight: bold;<br />}</pre><pre name="1f60">p {<br />margin: 0;<br />}</pre><pre name="c30e">.open-task {<br />display: block;<br />float: right;<br />}</pre><pre name="4ec4">form {<br />text-align: center;<br />}</pre><p name="2384">That gets us here:</p><figure name="e2a0"><img data-width="525" data-height="97" width="525" height="97" data-id="493719259356" src="https://d233eq3e3p3cv0.cloudfront.net/max/800/0*Ar9cq_T4xAVVrPq7.png" /></figure><p name="0f21">You can follow along, use the interface and play with the code at JSFiddle:</p><blockquote name="aa70"><a target="_blank" href="http://jsfiddle.net/cannikin/BZNQ6/8/">http://jsfiddle.net/cannikin/BZNQ6/8/</a></blockquote><p name="ac36">The first thing we want to do is hide the form by default, so let’s add an attribute to remove it from display:</p><pre name="a44b">form {<br />text-align: center;<br /><strong>display: none;</strong><br />}</pre><p name="693f">Now we’ve established the base state of our task which is to be “closed” with no form visible. To designate our task as “open” we’re going to add a class <em>.open</em> to the <em>.task</em> container. Let’s create the style that makes that happen:</p><pre name="b303">.task.open form {<br />display: block;<br />}</pre><figure name="fe96"><img data-width="512" data-height="73" width="512" height="73" data-id="1130440491912" src="https://d233eq3e3p3cv0.cloudfront.net/max/800/0*uwBEbXwvlIavaa4H.png" /></figure><p name="d02a">When something with the class <em>.task</em> also has the class<em> .open</em> any forms inside should be visible.</p><p name="5572">So how do we get that <em>.open</em> class added to the task? That’s a job for Javascript. Clicking the “Open” link should open the form. We need a data-behavior on the link:</p><pre name="12bc">&lt;a href="#" class="open-task" <strong>data-behavior="open"</strong>&gt;Open&lt;/a&gt;</pre><p name="91d5">Then we listen for the default browser click behavior by looking for elements with <em>data-behavior=”open”</em> and trigger our own custom event on the task container:</p><pre name="c996">$('.task').on('click', '[data-behavior~=open]', function() {<br />$(this).closest('.task').trigger('open.task'); <br />return false;<br />});</pre><p name="ff16">When someone clicks on an element with the behavior of <em>open</em> we trigger our custom event <em>open.task</em> on the task container itself, not the link that was clicked (<strong>closest()</strong> goes up the DOM and finds the first element that matches the parameter passed in). All of our events are collected on a single element which makes it easy to re-use this code (anywhere a task goes all the events go with it), easier to maintain in the future (we have one place to look to find all our application-specific logic) and just plain easier to think about (everything having to do with a task happens on the <em>.task </em>element).</p><p name="50b1"><strong>return false</strong> makes sure that the link to <strong>#</strong> doesn’t actually get followed (which would make the browser jump to the top of the page).</p><p name="bd34">Now we’re ready to show our form. We’ll watch for our new custom event on the task and add the class:</p><pre name="1014">$('.task').on('open.task', function() {<br />$(this).addClass('open'); <br />});</pre><p name="ab5f">Ahhh, doesn’t that look nice? Try it out at JSFiddle:</p><blockquote name="2b5a"><a target="_blank" href="http://jsfiddle.net/cannikin/BZNQ6/9/">http://jsfiddle.net/cannikin/BZNQ6/9/</a></blockquote><p name="3361">Let’s add some functionality. We’ll allow the user to close the task back up without completing it. We need a close button:</p><pre name="d32c">...<br />&lt;a href="#" class="open-task" data-behavior="open" href="#"&gt;Open&lt;/a&gt;<br /><strong>&lt;a class="close-task" data-behavior="close" href="#"&gt;Close&lt;/a&gt;</strong><br />...</pre><p name="71da">And a style that will hide it by default:</p><pre name="0661">.close-task {<br />display: none;<br />float: right;<br />}</pre><p name="59b4">The <strong>float: right;</strong> will put it in the same position the “Open” link is in currently. Remember that the task being closed is the default state, so this style means that the close button will be hidden by default. The functionality will work like so: when the task is open, show the form and show the “Close” link. When the task is closed hide the form and show only the “Open” link.</p><p name="3fb8">Let’s add a style that will hide the “Open” link and show the “Close” link when the task is open:</p><pre name="262c">.task.open .close-task {<br />display: block;<br />}</pre><pre name="665e">.task.open .open-task {<br />display: none;<br />}</pre><p name="8967">And the Javascript that watches for the Close button to be clicked and removes the <em>.open</em> class on the task:</p><pre name="55a0">$('.task').on('click', '[data-behavior~=close]', function() {<br />$(this).closest('.task').trigger('close.task');<br />return false;<br />});</pre><pre name="db73">$('.task').on('close.task', function() {<br />$(this).removeClass('open');<br />});</pre><figure name="6885"><img data-width="512" data-height="96" width="512" height="96" data-id="917859349604" src="https://d233eq3e3p3cv0.cloudfront.net/max/800/0*ggZRwUVC58B8IuQ5.png" /></figure><blockquote name="aca7"><a target="_blank" href="http://jsfiddle.net/cannikin/BZNQ6/10/">http://jsfiddle.net/cannikin/BZNQ6/10/</a></blockquote><p name="fe10">Okay, let’s focus on the form. Let’s pretend, for this example’s sake, that saving the form will always be successful. In that case we’ll close the form and dim the task to indicate that it’s complete.</p><p name="a3bd">We need a <em>data-behavior</em> on the “Save” link:</p><pre name="9273">&lt;a href="#" class="save" <strong>data-behavior="save"</strong>&gt;Save&lt;/a&gt;</pre><p name="9b9a">And we’ll attach a listener to that behavior and trigger our own event:</p><pre name="8a3e">$('.task').on('click', '[data-behavior~=save]', function() {<br />$(this).closest('.task').trigger('save.task');<br />return false;<br />});</pre><p name="984e">Saving a task means we’re going to make an AJAX call to the server to save the data. Listen for <em>save.task</em> and AJAX away:</p><pre name="a5fe">$('.task').on('save.task', function() {<br />var $this = $(this);<br />$.post('/echo/json').success(function(data) {<br />$this.trigger('saved.task', data);<br />});<br />});</pre><p name="7c6e">We fire our off our AJAX request (to a JSFiddle test endpoint) and assume it returns successfully. We listen for the success event and once again trigger our own custom event.</p><p name="9bc9">“Another custom event?!” you’re saying? Yes. Any time our task is in a new state we want an event to go with it. Next week our product manager requests that completing task #1 should also cause task #2 to be marked as complete. Easy: just trigger <em>complete.task</em> on task #2 and everything that needs to happen happens, no need to worry about appending the second task’s unique <em>id</em> attribute to a jQuery selector or messing with <strong>.next()</strong> and <strong>.prev()</strong> to try and select the right elements.</p><p name="267f">Notice that we’re passing a second parameter to our event trigger: <strong>$this.trigger(‘saved.task’, data);</strong> This is another under-used feature of jQuery’s event model. It allows you to pass around extra parameters to go along with the event itself.</p><p name="a9c8">When our form is saved we want to mark it as complete. Let’s create an event:</p><pre name="e82a">$('.task').on('saved.task', function(e, data) {<br />$(this).trigger('complete.task');<br />});</pre><p name="4705">We’re receiving that extra <strong>data</strong> parameter that we passed in above (although we aren’t doing anything with it in our example here). Completing a task should close and dim it. We already have an event for closing a task so we can just trigger it when we hear the <em>complete.task</em> event:</p><pre name="65ff">$('.task').on('complete.task', function() {<br />$(this).trigger('close.task');<br />});</pre><p name="6cf7">This is where these custom events start to be fun. We now have events with meaningful names that will put our task into known visual states. No more chaining a bunch of jQuery selectors together to add a class or change a background color or fade something out. Just <em>close.task</em> and everything happens for us.</p><p name="488f">Let’s also give the task a class of <em>.complete</em> so we can attach our “dimmed” visuals:</p><pre name="11a8">$('.task').on('complete.task', function() {<br />$(this).trigger('close.task');<br /><strong>$(this).addClass('complete');</strong><br />});</pre><p name="dcde">Finally, we’ll add a CSS class that determines what a complete task looks like:</p><pre name="04c5">.task.complete {<br />background-color: #dddddd;<br />color: #999999;<br />}</pre><pre name="26a3">.task.complete .open-task {<br />display: none;<br />}</pre><p name="6f92">We dim the background and text and also hide the Open link so it can’t be changed.</p><figure name="7b4d"><img data-width="541" data-height="74" width="541" height="74" data-id="1115908960341" src="https://d233eq3e3p3cv0.cloudfront.net/max/800/0*N9y-47cp3xPLSApX.png" /></figure><blockquote name="6cb1"><a target="_blank" href="http://jsfiddle.net/cannikin/BZNQ6/">http://jsfiddle.net/cannikin/BZNQ6/</a></blockquote><p name="b267">The interaction on our box isn’t very exciting—everything pops in and out of existence as we click around. Check out one last Fiddle that includes a touch of animation to make the interaction a little more pleasant. It also tightens up the JS by chaining all of the listeners together instead of re-selecting <strong>$(‘task’)</strong> over and over again (thanks <a target="_blank" href="http://ridingtheclutch.com/post/64963938960/event-focused-js-and-css-efjac#comment-1096673665">ultimatedelman</a> for the suggestion). It does sacrifice some of the code scanability for performance, however:</p><blockquote name="4193"><a target="_blank" href="http://jsfiddle.net/cannikin/BZNQ6/11/" rel="nofollow">http://jsfiddle.net/cannikin/BZNQ6/11/</a></blockquote><h3 name="57e1">A quick note on code organization</h3><p name="4f81">I like to organize the Javascript by keeping all of the DOM event listeners together and all of my custom event listeners together. The DOM events can usually be ignored completely when you come back to this code in the future. Reading through the custom event handlers almost tells a little story about how your UI works: “when a form is saved it’s marked as completed and closed.”</p><p name="8854">I use SASS in my own projects so my stylesheets feel much cleaner than the raw CSS used here (all the duplicate <em>.task.open</em> declarations, for example). Here’s what these stylesheets look like with SASS:</p><blockquote name="9fdd"><a target="_blank" href="http://jsfiddle.net/cannikin/GnhH9/1/">http://jsfiddle.net/cannikin/GnhH9/1/</a></blockquote><h2 name="434c">Conclusion</h2><p name="52a9">There you have it: what I hope is a sensible and semantic approach to organizing your CSS and JS for maximum enjoyment and maintainability. Hopefully the name makes sense now: all of our CSS and JS is focused around events that we create that have meaning for our application.</p><p name="43d1">You’re probably thinking this is a lot more code than I’m used to writing for something that seems so simple. And you’re right, it is more code. But making something flexible and maintainable will almost always include more code than just writing a quick one-off solution. The hope is that the extra typing actually makes it easier to maintain the code in the future.</p><p name="0bab">Don’t underestimate the amount of time and mental overhead involved in figuring out how your own code works six months or a year later. Sometimes having more, but cleaner and well-organized code actually makes the task easier. Writing everything as a one-off will more often than not give your future self nightmares. Notice that when you view <a target="_blank" href="http://jsfiddle.net/cannikin/BZNQ6/6/">http://jsfiddle.net/cannikin/BZNQ6/6/</a> you can just scan down the “Custom Events” section of the JS and see all your behaviors in one neat line: <em>open.task</em>, <em>close.task</em>, <em>save.task</em>, <em>saved.task</em>, <em>complete.task</em>. You can find everything with one quick scan and the story of your app unfolds as you read down the page.</p><p name="bea0">I would appreciate any feedback and suggestions for improvement! Leave comments here or on my blog: <a target="_blank" href="http://goo.gl/R0Z6O6">http://goo.gl/R0Z6O6</a></p><p name="e443">Let’s make the web better.</p><figure name="e528"><img data-width="3008" data-height="1374" width="700" height="320" data-action="zoom" data-action-value="0*QL4uLyMh47p--DgK.jpeg" data-id="1231954613436" src="https://d233eq3e3p3cv0.cloudfront.net/max/800/0*QL4uLyMh47p--DgK.jpeg" /></figure></div></div>
<script>var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-34802167-1']); _gaq.push(['_setDomainName', 'liuzhe.co']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();</script></body>
</html>