<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<link rel="stylesheet" href="../css/article.css" />
</head>
<body>
<div class="m-content">
<h1></h1>
<div class="blog" id="blog-content"><span>
	</span><div class="interview"><span>
		</span><div class="intro"><span>
			</span><p>This article, co-written by <a href="http://stevesouders.com/bio.html">Steve Souders</a>, is the fourth in a series of articles describing experiments conducted to learn more about optimizing web page performance (<a href="http://yuiblog.com/blog-archive/blog/2006/11/28/performance-research-part-1/">Part 1</a>, <a href="http://yuiblog.com/blog-archive/blog/2007/01/04/performance-research-part-2/">Part 2</a>, <a href="http://yuiblog.com/blog-archive/blog/2007/03/01/performance-research-part-3/">Part 3</a>). You may be wondering why you're reading a performance article on the YUI Blog. It turns out that most of web page performance is affected by front-end engineering, that is, the user interface design and development.</p></div><span> </span></div><span>
	</span><h3 id="parallel-downloads">Parallel Downloads</h3><span>
	</span><p>The biggest impact on end-user response times is the number of components in the page. Each component requires an extra HTTP request, perhaps not when the cache is full, but definitely when the cache is empty. Knowing that the browser performs HTTP requests in parallel, you may ask why the number of HTTP requests affects response time. Can't the browser download them all at once?</p><p>The explanation goes back to the HTTP/1.1 spec, which suggests that browsers download two components in parallel per hostname. Many web pages download all their components from a single hostname. Viewing these HTTP requests reveals a stair-step pattern, as shown in Figure 1.<div class="chart" id="figure-1"><span>
			</span><h4><strong>Figure 1.</strong> Downloading 2 components in parallel</h4><span>
			</span><p><img alt="Figure 1. Downloading 2 components in parallel" height="200" id="two_parallel" longdesc="two_parallel.gif" src="http://yuiblog.com/blog-archive/assets/performance/two_parallel.gif" width="311" /></p></div> </p><p>If a web page evenly distributed its components across two hostnames, the overall response time would be about twice as fast. The HTTP requests would look as shown in Figure 2, with four components downloaded in parallel (two per hostname). The horizontal width of the box is the same, to give a visual cue as to how much faster this page loads.<div class="chart" id="figure-2"><span>
			</span><h4><strong>Figure 2.</strong> Downloading 4 components in parallel</h4><span>
			</span><p><img alt="Figure 2. Downloading 4 components in parallel" height="200" id="four_parallel" longdesc="four_parallel.gif" src="http://yuiblog.com/blog-archive/assets/performance/four_parallel.gif" width="311" /></p></div> </p><p>Limiting parallel downloads to two per hostname is a guideline. By default, both Internet Explorer and Firefox follow the guideline, but users can override this default behavior. Internet Explorer stores the value in the Registry Editor. (See <a href="http://support.microsoft.com/?kbid=282402">Microsoft Help and Support</a>.) Firefox's setting is controlled by the <span>network.http.max-persistent-connections-per-server</span> setting, accessible in the about:config page.</p><p>It's interesting to note that for HTTP/1.0, Firefox's default is to download eight components in parallel per hostname. Figure 3 shows what it would look like to download these ten images if Firefox's HTTP/1.0 settings are used. It's even faster than Figure 2, and we didn't have to split the images across two hostnames.<div class="chart" id="figure-3"><span>
			</span><h4><strong>Figure 3.</strong> Downloading 8 components in parallel</h4><span>
			</span><p><img alt="Figure 3. Downloading 8 components in parallel" height="200" id="eight_parallel" src="http://yuiblog.com/blog-archive/assets/performance/eight_parallel.gif" width="311" /></p></div> </p><p>Most web sites today use HTTP/1.1, but the idea of increasing parallel downloads beyond two per hostname is intriguing. Instead of relying on users to modify their browser settings, front-end engineers could simply use CNAMEs (DNS aliases) to split their components across multiple hostnames. Maximizing parallel downloads doesn't come without a cost. Depending on your bandwidth and CPU speed, too many parallel downloads can degrade performance.</p><p>If browsers limit the number of parallel downloads to two (per hostname over HTTP/1.1), this raises the question:<h3 id="what-if">What if we use additional aliases to increase parallel downloads in our pages?</h3>
	</p><p>We've seen a couple great blogs and articles written recently on the subject, most notably <a href="http://www.ajaxperformance.com/?p=33">Ryan Breen of Gomez</a> and <a href="http://www.die.net/musings/page_load_time/">Aaron Hopkins over at Google</a>. Here's another spin. The performance team at Yahoo! ran an experiment to measure the impact of using various numbers of hostname aliases. The experiment measured an empty HTML document with 20 images on the page. The images were fetched from the same servers as those used by real Yahoo! pages. We ran the experiment in a controlled environment using a test harness that fetches a set of URLs repeatedly while measuring how long it takes to load the page on DSL. The results are shown in Figure 4.<div class="chart" id="figure-4"><span>
			</span><h4><strong>Figure 4.</strong> Loading an Empty HTML Document with 20 images using Various Number of Aliases</h4><span>
			</span><p><img alt="Figure 4. Loading an Empty HTML Document with 20 images using Various Number of Aliases" height="386" id="expt" src="http://yuiblog.com/blog-archive/assets/performance/expt.gif" width="576" /></p><p class="gloss"><strong>Note: </strong> Times are for cached aliases, empty file cache page loads on DSL (~800 kbps).</p></div> </p><p>In our experiment, we vary the number of aliases: 1, 2, 4, 5, and 10. This increases the number of parallel downloads to 2, 4, 8, 10, and 20 respectively. We fetch 20 smaller-sized images (36 x 36 px) and 20 medium-sized images (116 x 61 px). To our surprise, increasing the number of aliases for loading the medium-size images (116 x 61px) worsens the response times using four or more aliases. Increasing the number of aliases by more than two for smaller-sized images (36 x 36px) doesn't make much of an impact on the overall response time. On average, using two aliases is best.</p><p>One possible contributor for slower response times is the amount of CPU thrashing on the client caused by increasing the number of parallel downloads. The more images that are downloaded in parallel, the greater the amount of CPU thrashing on the client. On my laptop at work, the CPU jumped from 25% usage for 2 parallel downloads to 40% usage for 20 parallel downloads. These values can vary significantly across users' computers but is just another factor to consider before increasing the number of aliases to maximize parallel downloads.</p><p>These results are for the case where the domains are already cached in the browser. In the case where the domains are not cached, the response times get significantly worse as the number of hostname aliases increases. For web pages desiring to optimize the experience for first time users, we recommend not to increase the number of domains. To optimize for the second page view, where the domains are most likely cached, increasing parallel downloads does improve response times. The choice depends on which scenario was most typical.</p><p>Another issue to consider is that DNS lookup times vary significantly across ISPs and geographic locations. Typically, DNS lookup times for users from non-US cities are significantly higher than those for users within the US. If a good percentage of your users are coming from outside the US, the benefits of increasing parallel downloads is offset by the time to make many DNS lookups.</p><p>Our rule of thumb is to increase the number of parallel downloads by using at least two, but no more than four hostnames. Once again, this underscores the number one rule for improving response times: reduce the number of components in the page.  </p></div></div>
<script>var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-34802167-1']); _gaq.push(['_setDomainName', 'liuzhe.co']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();</script></body>
</html>