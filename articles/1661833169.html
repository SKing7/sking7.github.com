
        <!doctype html>
        <html>
        <head>
            <meta charset="utf-8"/>
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
            <title>【第881期】Hybrid 开发：JsBridge</title>
            <link rel="stylesheet" href="../css/article.css" />;
        </head>
        <body>
            <div class="m-content">
                <h1>【第881期】Hybrid 开发：JsBridge</h1>
                <div class="rich_media_content " id="js_content"><span>
                        
                       
                        

                        
                        
                        </span><p>前言<br></p><p>现在混合式开发有好几种，一种就是 Hybrid，一种是 RN，一种是原生内嵌 RN 或 Weex。那你们公司目前是采用哪一种呢？3 月 21 号早读文章来自 百度 @ 三水清的授权分享。</p><p>正文从这开始～</p><p>Hybrid开发中，web页面往往会跟native进行交互，而JSBridge就是web页面和native进行通信的桥梁，通过JSBridge可以实现web调用native的方法，native可以通过 webview.loadUrl之类的方法，将 javascript:xxx代码放在页面执行，这有点类似在浏览器地址栏直接输入： javascript:xxx</p><p>本文较长，先把目录列出来：</p><p><span>JSBridge多种形式</span></p><ul class=" list-paddingleft-2"><li><p>js Interface 直接注入到window对象</p></li><li><p>改写浏览器原有对象：alert/console/prompt</p></li><li><p>URL scheme</p></li></ul><p><span>唤起APP技术</span></p><ul class=" list-paddingleft-2"><li><p>intent</p></li><li><p>localserver</p></li><li><p>scheme：deeplink/applink/Universal link</p></li><li><p>smart app banner</p></li></ul><p><span>JSBridge安全</span></p><p><span>JSBridge的最佳实践</span></p><ul class=" list-paddingleft-2"><li><p>协议规范</p></li><li><p>回调函数</p></li><li><p>预留升级/统计能力</p></li><li><p>简单JSBridge 调用封装</p></li></ul><p><span><strong>JSBridge多种形式</strong></span></p><p>web和native进行通信，方法有很多，接下来一一列举一下JSBridge的多种形式，及其利弊。</p><p><span>JavaScriptInterface</span><br></p><p>JSInterface是安卓4.2-官方推荐的解决方案，原理是通过WebView提供的 addJavascriptInterface方法给浏览器 window注入一个命名空间，然后给Web增加一些可以操作Java 的反射。</p><pre class="public-DraftStyleDefault-pre"><p><br>mWebView<span class="token punctuation">.</span><span class="token function">addJavascriptInterface</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">(),</span><span class="token string">'android'</span><span class="token punctuation">);</span><br><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Class</span><span class="token punctuation">(){</span><br>@JavascriptInterface<br><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(){</span><br><span class="token punctuation">}</span><br><span class="token punctuation">}</span><br>window<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">();</span></p></pre><p>JSInterface在4.2之前的版本都可以，但是存在严重的安全隐患，容易被利用提权，从而调用各种Java的类和权限，甚至页面可以挂马。在我们实际产品（手机百度）开始阶段，用过这个方法，不过现在已经不使用了。</p><p><span>改写浏览器原有对象</span></p><p>这个方法主要是通过修改原来浏览器的 window某些方法，然后拦截固定规则的参数，然后分发给Java对应的方法去处理。这里常用的是以下四个方法：</p><ul class=" list-paddingleft-2"><li><p>alert，可以被webview的 onJsAlert监听</p></li><li><p>confirm，可以被webview的 onJsConfirm监听</p></li><li><p>console.log，可以被webview的 onConsoleMessage监听</p></li><li><p>prompt，可以被webview的 onJsPrompt监听</p></li></ul><p>prompt简单举例说明，Web页面通过调用 prompt()方法，安卓客户端通过监听 onJsPrompt事件，拦截传入的参数，如果参数符合一定协议规范，那么就解析参数，扔给后续的Java去处理。这种协议规范，最好是跟iOS的协议规范一样，这样跨端调起协议是一致的，但具体实现不一样而已。比如： hybrid://action?arg1=1 这样的协议，而其他格式的 prompt参数，是不会监听的，即除了 hybrid://action?arg1=1 这样的规范协议， prompt还是原来的 prompt。</p><p>这四个方法也是各有利弊，比如：</p><p>alert/ console.log是调试最常用的，如果你要看看协议是不是写错了，但是传入协议却被拦截了。。</p><p>confirm和 prompt都带返回值， prompt是四个里面唯一可以自定义返回值，可以做同步的交互，要比写各种回调更「顺」，但是一旦串行调用了，就要骂爹了</p><p>prompt是我们目前安卓用的比较多的JSBridge解决方案。</p><p><span>URL scheme</span></p><p>这个叫法不是特别贴切，scheme是URI的一种格式，上文提到的 hybrid://action?arg1=1就是一个scheme协议，这里说的scheme（或者schema）泛指安卓和iOS的schema协议，因为它通用。</p><p>安卓和iOS都可以通过拦截跳页URL请求，然后解析这个scheme协议，符合约定规则的就扔个Native的方法处理。安卓和iOS分别用到拦截URL请求的方法是：</p><ul class=" list-paddingleft-2"><li><p>安卓：shouldOverrideUrlLoading方法</p></li><li><p>iOS：UIWebView的delegate函数</p></li></ul><p><span>唤起APP技术</span></p><p>上文介绍到的JSBridge是在APP内的Web页面跟APP进行交换，还有一种特别多的需求，就是在APP外（浏览器、微信等）调起APP自己，给APP进行导流。这时候就要用到APP的唤起技术。这里有一下几种方法：</p><ul class=" list-paddingleft-2"><li><p>intent：安卓</p></li><li><p>localserver：安卓</p></li><li><p>Universal links：iOS 9+</p></li><li><p>Deep link/Applink：安卓</p></li><li><p>smart app banner：iOS</p></li><li><p>安卓intent</p></li></ul><p>intent格式示例如下：</p><pre class="public-DraftStyleDefault-pre"><p>intent<span class="token punctuation">:</span><br>HOST<span class="token operator">/</span>URI<span class="token operator">-</span>path <br>#Intent<span class="token punctuation">;</span> <br><span class="token keyword">package</span><span class="token operator">=</span><span class="token punctuation">[</span>string<span class="token punctuation">];</span><br>action<span class="token operator">=</span><span class="token punctuation">[</span>string<span class="token punctuation">];</span><br>category<span class="token operator">=</span><span class="token punctuation">[</span>string<span class="token punctuation">];</span><br>component<span class="token operator">=</span><span class="token punctuation">[</span>string<span class="token punctuation">];</span><br>scheme<span class="token operator">=</span><span class="token punctuation">[</span>string<span class="token punctuation">];</span><br>S<span class="token punctuation">.</span>xxx<span class="token operator">=</span>xxx<br>end<span class="token punctuation">;</span></p></pre><p>第一部分：host和path是跟url无异</p><p>第二部分：#intent到end是完整的intent，包含了调起的app包名，action等是常用的配置项</p><p>因为Intent不仅仅是调起APP，而是安卓客户端内部模块通信也会用，所以权限很大，一般浏览器都给封掉了，</p><p><span>安卓localserver</span></p><p>这是一个黑科技，早前安卓允许在本地启动一个本地server，这个server是在后台守候的，通过这个localserver都可以进行各种需求：app间通信、app调起、收集数据、基础服务。百度的moplus就是这样的一个localserver。</p><p>举例说明：启动一个本地server，端口号是： 8888，那么在手机上，网页就可以通过： http://127.0.0.1:8888 访问这个server，server接收到请求就可以进行一些native的操作，对于需要回调数据的，就通过返回请求内容来执行，比如：</p><p>获取个定位信息，js执行 $.get('http://127.0.0.1:8888/getGeoLocation?callback=cbname')</p><p>server收到请求之后，调用native方法，获取GPS的定位信息，然后将数据通过response： window.cbname&amp;&amp;cbname({xxx})给页面返回定位数据</p><p>如果控制不好权限，因为localserver是一直后台守候的，容易被利用，比如提权获取通讯录、甚至给通讯录发短信、容易造成蠕虫攻击，感兴趣的可以搜下moplus的文章。另外安卓各种安全软件，都会清理内存和后台程序，很容易被干掉进程。浏览器也会封杀本地server调起，碰见127.0.0.1的请求就直接拦截。</p><p><span>Universal links / Deep link / Applink</span></p><p>这三个是官方推荐的调起方法，调起协议格式也是可以统一的，比如前文提到的 hybrid://action?arg1=xxx这类scheme协议就是。这样可以统一安卓和iOS调起和JSBridge通信。</p><p>其实简单来说，这三个出发点是想给应用做分发，但是如果用户手机没有安装这个APP，那么就调起失败，这时候直接不管不问，肯定体验不好，而且浪费了点击资源，那么做成分发吧！将调起协议做成一个调起页面，放到一个域名下，点击这个URL就可以打开这个页面，页面执行代码调起APP，如果调起失败就展现APP的介绍，做分发。</p><p>Universal links / Deep link / Applink，就是这样的一个过程，通过这个域名授权，把URL分发给APP进行处理，唯一不同的是：如果用户安装了APP，那么就不用打开这个分发页面了。</p><p><span>Universal Links</span></p><p>iOS 9新出的一个功能，需要在App内声明一个https域名（ul.test.com），然后在该网站根目录放置apple-app-site-association文件，文件指明了转发规则，例如：</p><pre class="public-DraftStyleDefault-pre"><p><span class="token punctuation">{</span><br><span class="token string">"applinks"</span><span class="token punctuation">:{</span><br><span class="token string">"apps"</span><span class="token punctuation">:[],</span><br><span class="token string">"details"</span><span class="token punctuation">:[</span><br><span class="token punctuation">{</span><br><span class="token string">"appID"</span><span class="token punctuation">:</span>“xxx<span class="token punctuation">.</span>com<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>SomeApp”<span class="token punctuation">,</span><br><span class="token string">"paths"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"*"</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span><br><span class="token punctuation">]</span><br><span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></p></pre><p>当APP安装成功之后，会下载这个文件，明确知道遇见 ul.test.com的域名的URL时候，会把这个URL扔给你的APP，让你去解析，APP拿到这个URL就可以解析出来需要做什么事情。</p><p>Universal Link是iOS 9+的底层实现，所以在任何地方都可以直接调起APP，不受微信这类封闭APP的限制。</p><p><span>Deep link / Applink</span></p><p>Deep link 是安卓一开始推出的，主要用于搜索调起APP，后来推出 Applink，实际是Deep link的升级版。</p><p>这里需要提到微信的APPlink，毕竟微信作为SuperApp，是很大的分发资源，微信有自己的分发方法，安卓内可以申请微信的APPlink，跟Universal link一样，也是一个域名下面的URL，符合一定规则就由微信（ios是底层系统）扔个对应的域名APP进行解析。</p><p><span>smart app banner</span></p><p>在页面的head中添加下面meta，在Safari浏览器中就会出现下面的banner</p><pre class="public-DraftStyleDefault-pre"><p><span class="token operator">&lt;</span>meta name<span class="token operator">="apple-itunes-app"</span> content<span class="token operator">="app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL"&gt;</span></p></pre><figure><img data-src="http://mmbiz.qpic.cn/mmbiz_jpg/meG6Vo0MevgzChNPFbsAb5iczTmxObG52s7IVDC5x8jzkWDFR4apAhEiaKHs1Ciazpmz9JQIH1KRibibG2zv3qwEicHQ/0?wx_fmt=jpeg" data-type="jpeg" data-ratio="1.7758064516129033" data-w="620"><p class="image-caption">AppStore</p></figure><p><span><strong>JSBridge安全</strong></span></p><p>在APP内JSBridge可以实现Web和Native的通信，但是如果APP打开一个恶意的页面，页面可以任意调用JSBridge方法，获取各种隐私的数据，就会引起安全问题。</p><p>JSBridge的安全有两个方法：通过Native进行白名单配置，通过Server云端授权。Server的云端授权这块，放到后续JSSDK的设计部分进行详细讲解。本文主要说下通过Native的方式来控制JSBridge的安全。</p><p>假设JSBridge的协议格式如下：</p><pre class="public-DraftStyleDefault-pre"><p>hybrid<span class="token punctuation">:</span><span class="token operator">//</span>action<span class="token operator">/</span>method<span class="token operator">?</span>arg1<span class="token operator">=</span>xxx<span class="token operator">&amp;</span>arg2<span class="token operator">=</span>xxx</p></pre><p>可以通过下面方式进行安全设置：</p><ul class=" list-paddingleft-2"><li><p>配置某些方法的使用范围，比如固定的Webview，固定的domain</p></li><li><p>通过正则来设置细化的权限，比如：baidu.com网页可以使用 *，hao123.com可以使用： hybrid://hao123/*</p></li></ul><p><span><strong>JSBridge的最佳实践</strong></span></p><p>介绍了这么多，什么是最佳实践的JSBridge呢？结合文章内容，要求JSBridge做到以下几点：</p><ul class=" list-paddingleft-2"><li><p>官方认可，不走「歪门邪道」</p></li><li><p>跨平台通用</p></li><li><p>APP内和APP外规范通用</p></li><li><p>安全可靠</p></li><li><p>约定大于配置的原则</p></li></ul><p>综合上文介绍的内容，JSBridge的最佳实践是：</p><ul class=" list-paddingleft-2"><li><p>协议规范都使用： hybrid://action/method?arg1=xxx&amp;arg2=xxx</p></li><li><p>iOS使用Universal Link和UIWebview的delegate</p></li><li><p>安卓使用shouldOverrideUrlLoading和Applink</p></li></ul><p><span><strong>规范和约定</strong></span></p><p>先贴个URL scheme的图片，理解下URL的组成部分：</p><figure><img data-src="http://mmbiz.qpic.cn/mmbiz_png/meG6Vo0MevgzChNPFbsAb5iczTmxObG52vCbpSAZ1ODmH6IXxZpC9vlkmiaI8ttSUlFQeFId0urLOdlvGMpI5vZw/0?wx_fmt=png" data-type="png" data-ratio="0.4546875" data-w="640"><p class="image-caption">URL scheme</p></figure><p>约定我们的规范如下：</p><pre class="public-DraftStyleDefault-pre"><p>yourappscheme<span class="token punctuation">:</span><span class="token operator">//</span>module<span class="token operator">/</span>action<span class="token operator">?</span>arg1<span class="token operator">=</span>x<span class="token operator">&amp;</span>arg2<span class="token operator">=</span>x<span class="token operator">&amp;</span>ios_version<span class="token operator">=</span>xxx<span class="token operator">&amp;</span>andr_version<span class="token operator">=</span>xxx<span class="token operator">&amp;</span>upgrade<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token operator">&amp;</span>callback<span class="token operator">=</span>xxx<span class="token operator">&amp;</span>sendlog<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span></p></pre><ul class=" list-paddingleft-2"><li><p>整体小写</p></li><li><p>yourappscheme：就是你的scheme，可辨识，别冲突，通过这个可以进行Universal Link和Applink的分发</p></li><li><p>module和action：某个模块组件的某个方法</p></li><li><p>?后面是querystring，这里预定了几个特殊的参数：</p></li></ul><p>ios_version/andr_version：非必须，iOS和安卓的最小版本，即本协议从哪个版本开始支持的，低版本不支持则忽略，配合upgrade使用进行APP升级</p><p>upgrade：是否强制升级，即当版本低于设置的ios/andr_version是否弹出提示用户升级的对话框（yourappscheme已经可以调起app，只不过功能可能因为版本低不支持，这时候可以引导用户升级）</p><p>callback：异步回调函数，下面详细树下callback的最佳实践</p><p>sendlog：调起后是否打点发送日志</p><p>举例：</p><pre class="public-DraftStyleDefault-pre"><p># 账号相关<br>## 打开用户个人主页<br>fb<span class="token punctuation">:</span><span class="token operator">//</span>account<span class="token operator">/</span>userprofile<span class="token operator">?</span>id<span class="token operator">=</span>xxx<br>## 打开登录界面<br>fb<span class="token punctuation">:</span><span class="token operator">//</span>account<span class="token operator">/</span>login<span class="token operator">?</span>callback<span class="token operator">=</span>xxx<br># 工具类<br>## 获取定位<br>fb<span class="token punctuation">:</span><span class="token operator">//</span>utils<span class="token operator">/</span>getgeolocation<span class="token operator">?</span>callback<span class="token operator">=</span>xx</p></pre><p><span>callback的设计</span></p><p>当native操作成功之后，会将处理结束后的结果或者数据通过 callback回调传给Web，当然有成果就又失败， callback的参数设计有两种方式：</p><p><span>错误优先</span></p><p>即下面的回调方法格式：</p><pre class="public-DraftStyleDefault-pre"><p><span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span>data<span class="token punctuation">){</span><br><span class="token keyword">if</span><span class="token punctuation">(</span>error<span class="token punctuation">){</span><br><span class="token keyword">throw</span> error<br><span class="token punctuation">}</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><br><span class="token punctuation">}</span></p></pre><p><span>JSON API式</span></p><p>即回调方法只接收一个JSON对象，JSON格式如下：</p><pre class="public-DraftStyleDefault-pre"><p><span class="token punctuation">{</span><br>error_code<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><br>data<span class="token punctuation">:{}</span><br><span class="token punctuation">}</span></p></pre><p><span>预留升级/日志能力</span></p><p>做APP开发经常会遇见下面的问题：</p><ul class=" list-paddingleft-2"><li><p>功能/端能力是从某个版本开始的，低版本用不了，但是scheme还是会调起APP（APP懵逼。。</p></li><li><p>对于低版本，PM希望提示用户升级</p></li><li><p>统计调起成功率，分发次数之类的统计需求</p></li></ul><p>scheme的querystring部分由 ios_version/andr_version和upgrade这三个成对的参数，可以解决升级问题，sendlog解决日志统计问题。</p><ul class=" list-paddingleft-2"><li><p>ios_version/andr_version：是标示该协议的最低支持版本，如果低于这个版本可能因为功能并未实现而能识别。</p></li><li><p>upgrade：是是否强制低版本弹出升级对话框</p></li><li><p>sendlog：当为1的时候，则发送调起成功失败之类的统计需求</p></li></ul><p><span>简单JSBridge调用封装</span></p><p>简单封装下JSBridge调用的方法，参数如下：</p><ul class=" list-paddingleft-2"><li><p>module：类名称，如果account</p></li><li><p>action：具体操作方法，如login</p></li><li><p>args：非必须，协议参数，支持string和对象</p></li><li><p>callback：非必须，回调单独提出来，方便全局方法命名</p></li></ul><p>具体代码如下</p><pre class="public-DraftStyleDefault-pre"><p><span class="token keyword">function</span> invoke <span class="token punctuation">(</span>module<span class="token punctuation">,</span>action<span class="token punctuation">,</span>args<span class="token punctuation">,</span>callback<span class="token punctuation">){</span><br><span class="token keyword">let</span> scheme <span class="token operator">=</span><span class="token template-string"><span class="token string">`yourappscheme://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>module<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>action<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?`</span></span><br><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>args<span class="token punctuation">)){</span><br>callback <span class="token operator">=</span>args<br>args <span class="token operator">=</span><span class="token keyword">null</span><br><span class="token punctuation">}</span><br><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isString</span><span class="token punctuation">(</span>args<span class="token punctuation">)){</span><br>scheme <span class="token operator">+=</span> args<br><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>args<span class="token punctuation">)){</span><br><span class="token function">each</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><br><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token operator">||</span> <span class="token function">isArray</span><span class="token punctuation">(</span>v<span class="token punctuation">)){</span><br>v <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> &nbsp; &nbsp; &nbsp;<br><span class="token punctuation">}</span><br>scheme <span class="token operator">+=</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>k<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> &nbsp; &nbsp;<br><span class="token punctuation">})</span> &nbsp; &nbsp; <br><span class="token punctuation">}</span><br><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>callback<span class="token punctuation">)){</span><br><span class="token keyword">var</span> funcName <span class="token operator">='_jsbridge_cb_'+</span> <span class="token function">getId</span><span class="token punctuation">()</span><br>window<span class="token punctuation">[</span>funcName<span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(){</span><br>callback<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token punctuation">([]).</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">))</span><br><span class="token punctuation">}</span><br>scheme <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token operator">!~</span>scheme<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'&amp;'</span> <span class="token punctuation">:</span> <span class="token string">'?'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token template-string"><span class="token string">`callback=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>funcName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><br><span class="token punctuation">}</span><br><span class="token keyword">if</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>ios <span class="token operator">&amp;&amp;</span> <span class="token function">versionCompare</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>version<span class="token punctuation">,</span> <span class="token string">'9.0'</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">){</span><br>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span>scheme &nbsp;<br><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span> &nbsp; &nbsp;<br><span class="token keyword">var</span> $node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><br>$node<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><br>$node<span class="token punctuation">.</span>src <span class="token operator">=</span> scheme<br><span class="token keyword">var</span> body <span class="token operator">=</span> document<span class="token punctuation">.</span>body <span class="token operator">||</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)[</span><span class="token number">0</span><span class="token punctuation">]</span><br>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>$node<span class="token punctuation">)</span><br><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(){</span><br>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>$node<span class="token punctuation">)</span><br>$node <span class="token operator">=</span> <span class="token keyword">null</span> &nbsp; &nbsp;<br><span class="token punctuation">},</span> <span class="token number">10</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><span class="token punctuation">}</span></p></pre><p>总结</p><p><span>介绍了JSBridge常用的方法，然后介绍了APP外如何唤起APP，还介绍了scheme协议，最后比较了优缺点，做个最佳实践。希望有用~</span></p><p><span>最后，你还可以看看：</span></p><p><span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&amp;mid=205938962&amp;idx=1&amp;sn=8e4f63e2d29ecccefb78a48f1570abba&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&amp;mid=205938962&amp;idx=1&amp;sn=8e4f63e2d29ecccefb78a48f1570abba&amp;scene=21#wechat_redirect">【第263期】基于Android Webview的Hybrid App开发的前端优化</a><br></span></p><p><span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&amp;mid=2651221456&amp;idx=1&amp;sn=813461f1d658cbdb337c76477c25ff3e&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&amp;mid=2651221456&amp;idx=1&amp;sn=813461f1d658cbdb337c76477c25ff3e&amp;scene=21#wechat_redirect">【第626期】浅谈Hybrid技术的设计与实现</a><br></span></p><p>关于本文</p><p>作者：@三水清（ID：三水清）</p><p>原文：http://dwz.cn/5zm9Yr</p><p><img data-ratio="0.4171875" data-s="300,640" data-src="http://mmbiz.qpic.cn/mmbiz_jpg/meG6Vo0Mevh23BmHxbsr9N45wwr9ljKlZbboIBcEzERicANYficwKawscaD4RFmQ2AVJ4bqlgbibKqv7aw91n6kEA/640?wx_fmt=jpeg" data-type="jpeg" data-w="640" width="auto"></p><span>
                    </span></div>
            </div>
            <script>var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-34802167-1']); _gaq.push(['_setDomainName', 'liuzhe.co']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();</script>
        </body>
        </html>