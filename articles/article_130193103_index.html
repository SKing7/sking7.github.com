<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="keywords" content="web performance faster web sites high performance web sites website optimization best practices javascript css web development mobile">
<title>JavaScript Performance | High Performance Web Sites</title>
<link rel="stylesheet" type="text/css" media="all" href="http://www.stevesouders.com/blog/wp-content/themes/SteveSouders/style.css" />
<link rel="alternate" type="application/rss+xml" title="High Performance Web Sites &raquo; JavaScript Performance Comments Feed" href="http://www.stevesouders.com/blog/2012/01/13/javascript-performance/feed/" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.stevesouders.com/blog/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.stevesouders.com/blog/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Silk, iPad, Galaxy comparison' href='http://www.stevesouders.com/blog/2011/12/01/silk-ipad-galaxy-comparison/' />
<link rel='next' title='HTTP Archive: 2011 recap' href='http://www.stevesouders.com/blog/2012/02/01/http-archive-2011-recap/' />
<meta name="generator" content="WordPress 3.6.1" />
<link rel='canonical' href='http://www.stevesouders.com/blog/2012/01/13/javascript-performance/' />
<link rel='shortlink' href='http://www.stevesouders.com/blog/?p=2375' />
<script type="text/javascript">
	window._wp_rp_static_base_url = 'http://dtmvdvtzf8rz0.cloudfront.net/static/';
	window._wp_rp_wp_ajax_url = "http://www.stevesouders.com/blog/wp-admin/admin-ajax.php";
	window._wp_rp_plugin_version = '2.6';
	window._wp_rp_post_id = '2375';
	window._wp_rp_num_rel_posts = '5';
</script>

<script>
(function(d, s) {
	var js = d.getElementsByTagName(s)[0],
		ln = d.createElement(s);
	ln.src = '//lognormal.net/boomerang/8fa4fc2785a82fae20c596ca4f45d1b218a9ab12ffef741d09b29532';
	js.parentNode.insertBefore(ln, js);
})(document, 'script');
</script>

<script type="text/javascript">
// GOOGLE ANALYTICS
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-15026169-1']);
_gaq.push(['_setSiteSpeedSampleRate', 100]);
_gaq.push(['_trackPageview']);

(function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
</head>

<body>
<div id="header">
	<div class="containerwrapper">
  		<h1 id="logo"><a href="http://stevesouders.com/"><span>SteveSouders.com</span></a></h1>
        <ul id="topnav">
        <li><a href="http://stevesouders.com/about.php">about</a></li>
        <li><a href="http://stevesouders.com/contact.php">contact</a></li>
        <li class="last"> <a href="http://twitter.com/#!/souders/"><img src="/images/twitter-icon.png" width=16 height=16 border=0 style="vertical-align: bottom;"></a>
        </ul>
	</div>    
</div>
<div id="contentWrapper" class="containerwrapper">
<div id="sidebar">
<div id="search-3" class="widget widget_search"><form role="search" method="get" id="searchform" class="searchform" action="http://www.stevesouders.com/blog/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form></div><div id="custom-recent-posts-3" class="widget custom-recent-posts"><h3 class="blockheader">Most Recent Posts</h3>		<ul style="list-style-type: none; margin-left: 20px; text-indent: -20px;">
        		<li><a href="http://www.stevesouders.com/blog/2013/09/05/domain-sharding-revisited/" rel="bookmark">Domain Sharding revisited</a></li>
				<li><a href="http://www.stevesouders.com/blog/2013/08/27/web-performance-for-the-future/" rel="bookmark">Web performance for the future</a></li>
				<li><a href="http://www.stevesouders.com/blog/2013/07/16/activetable-bookmarklet/" rel="bookmark">ActiveTable bookmarklet</a></li>
				<li><a href="http://www.stevesouders.com/blog/2013/07/15/twitter-widget-update/" rel="bookmark">Twitter widget update</a></li>
				<li><a href="http://www.stevesouders.com/blog/2013/06/16/browser-busy-indicators/" rel="bookmark">Browser Busy Indicators</a></li>
				</ul>
		<a href="http://www.stevesouders.com/blog/archives/">View Archive</a></div><div id="text-3" class="widget widget_text"><h3 class="blockheader">Feeds</h3>			<div class="textwidget"><a href="http://www.stevesouders.com/blog/feed/"><img src="/blog/wp-content/uploads/2011/02/feed.png" width="10" height="10" /> </a><a href="http://www.stevesouders.com/blog/feed/">Posts</a><br />
<a href="http://www.stevesouders.com/blog/comments/feed/"><img src="/blog/wp-content/uploads/2011/02/feed.png" width="10" height="10" /> </a><a href="http://www.stevesouders.com/blog/comments/feed/">Comments</a></li></div>
		</div>        
</div><div id="content">



		<div id="post-2375" class="post-2375 post type-post status-publish format-standard hentry category-browsers category-javascript category-performance category-tools category-web-development tag-async tag-browserscope tag-onload tag-webpagetest">
        	            	<h1>JavaScript Performance</h1>
            
			<p class="meta">January 13, 2012 10:09 pm | <a href="http://www.stevesouders.com/blog/2012/01/13/javascript-performance/#comments" title="Comment on JavaScript Performance">20 Comments</a></p><!-- .entry-meta -->

			<p>Last night I spoke at the <a href="http://www.meetup.com/jsmeetup/events/38563112/">San Francisco JavaScript Meetup</a>. I gave a brand new talk called <a href="http://www.slideshare.net/souders/javascript-performance-at-sfjs">JavaScript Performance</a> that focuses on script loading and async snippets. The snippet example I chose was the <a href="http://code.google.com/apis/analytics/docs/tracking/asyncTracking.html">Google Analytics async snippet</a>. The script-loading part of that snippet is only six lines, but a lot of thought and testing went into it. It&#8217;s a great prototype to use if you&#8217;re creating your own async snippet. I&#8217;ll tweet if/when the video of my talk comes out, but in the meantime the slides (<a href="http://www.slideshare.net/souders/javascript-performance-at-sfjs">Slideshare</a>, <a href="http://stevesouders.com/docs/sfjs-20120112.pptx">pptx</a>) do a good job of relaying the information.</p>
<p>There are two new data points from the presentation that I want to call out in this blog post.</p>
<h2>Impact of JavaScript</h2>
<p>The presentation starts by suggesting that JavaScript is typically the #1 place to look for making a website faster. My anecdotal experience supports this hypothesis, but I wanted to try to do some quantitative verification. As often happens, I turned to <a href="http://webpagetest.org/">WebPagetest</a>.</p>
<p>I wanted to test the Alexa Top 100 URLs with and without JavaScript. To load these sites withOUT JavaScript I used WebPagetest&#8217;s &#8220;block&#8221; feature. I entered &#8220;.js&#8221; which tells WebPagetest to ignore every HTTP request with a URL that contains that string. Each website was loaded three times and the median page load time was recorded. I then found the median of all these median page load times.</p>
<p>The median page load <em>with JavaScript</em> is 3.65 seconds. <em>Without JavaScript</em> the page load time drops to 2.487 seconds &#8211; a 31% decrease. (Here&#8217;s the data in WebPagetest: <a title="with JavaScript" href="http://www.webpagetest.org/result/120111_GR_2TW90/">with JavaScript</a>, <a title="without JavaScript" href="http://www.webpagetest.org/result/120111_0P_2TW4Q/">without JavaScript</a>.) It&#8217;s not a perfect analysis: Some script URLs don&#8217;t contain &#8220;.js&#8221; and inline script blocks are still executed. I think this is a good approximation and I hope to do further experiments to corroborate this finding.</p>
<p><center><img class="alignnone" title="Top 100 sites with and without JS" src="http://stevesouders.com/images/withoutjs.png" alt="" width="460" height="291" /></center></p>
<h2>Async Execution Order &amp; Onload</h2>
<p>The other new infobyte has to do with the <code style="font-size: 1.1em;">async=true</code> line from the GA async snippet. The purpose of this line is to cause the <code>ga.js</code> script to not block other async scripts from being executed. It turns out that some browsers preserve the execution order of scripts loaded using the insertBefore technique, which is the technique used in the GA snippet:</p>
<div class="codesample" style="font-family: monospace;">var ga = document.createElement(‘script’);<br />
ga.type = ‘text/javascript’;<br />
ga.async = true;<br />
ga.src = (‘https:’ == document.location.protocol ? ‘https://ssl’ : ‘http://www’) + ‘.google-analytics.com/ga.js’;<br />
var s = document.getElementsByTagName(‘script’)[0];<br />
s.parentNode.insertBefore(ga, s);</div>
<p>Preserving execution order of async scripts makes the page slower. If the first async script takes a long time to download, all the other async scripts are blocked from executing, even if they download sooner. Executing async scripts immediately as they&#8217;re downloaded results in a faster page load time. I knew old versions of Firefox had this issue, and setting <code>async=true</code> fixed the problem. But I wanted to see if any other browsers also preserved execution order of async scripts loaded this way, and whether setting <code>async=true</code> worked.</p>
<p>To answer these questions I created a <a href="http://www.browserscope.org/user/tests/howto">Browserscope user test</a> called <a href="http://stevesouders.com/tests/jsorder.php">Async Script Execution Order</a>. I tweeted the test URL and got 348 results from 60+ different browsers. (Thanks to all the people that ran the test! I still need results from more mobile browsers so please run <a href="http://stevesouders.com/tests/jsorder.php">the test</a> if you have a browser that&#8217;s not covered.) Here&#8217;s a snapshot of <a href="http://www.browserscope.org/user/tests/table/agt1YS1wcm9maWxlcnINCxIEVGVzdBjrq90MDA?v=3&amp;layout=simple&amp;highlight=1">the results</a>:</p>
<div style="margin-bottom: 1em; text-align: center;"><a href="http://www.browserscope.org/user/tests/table/agt1YS1wcm9maWxlcnINCxIEVGVzdBjrq90MDA?v=2&amp;layout=simple&amp;highlight=1"><img class="alignnone" title="Execution order results" src="http://stevesouders.com/images/jsorder.png" alt="" width="460" height="576" /></a></div>
<p>The second column shows the results of loading two async scripts with the insertBefore pattern AND setting <code>async=true</code>. The third column shows the results if <code>async</code> is NOT set to <code>true</code>. Green means the scripts execute immediately (good) and red indicates that execution order is preserved (bad).</p>
<p>The results show that Firefox 3.6, OmniWeb 622, and all versions of Opera preserve execution order. Setting <code>async=true</code> successfully makes the async scripts execute immediately in Firefox 3.6 and OmniWeb 622, but not in Opera. Although this fix only applies to a few browsers, its small cost makes it worthwhile. Also, if we get results for more mobile browsers I would expect to find a few more places where the fix is necessary.</p>
<p>I also tested whether these insertBefore-style async scripts block the onload event. The results, shown in the fourth column, are mixed if we include older browsers, but we see that newer browsers generally block the onload event when loading these async scripts &#8211; this is true in Android, Chrome, Firefox, iOS, Opera, Safari, and IE 10. This is useful to know if you wonder why you&#8217;re still seeing long page load times even after adopting async script loading. It also means that code in your onload handler can&#8217;t reliably assume async scripts are loaded because of the many browsers out there that do <em>not</em> block the 